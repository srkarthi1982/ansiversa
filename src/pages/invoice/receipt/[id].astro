---
import Layout from '../../../layouts/Layout.astro';
const identifier = Astro.params.id;
---
<Layout>
  <main
    class="min-h-screen bg-slate-50"
    x-data="() => ({ invoice: $store.invoice })"
    x-init={`invoice.initReceipt('${identifier}')`}
  >
    <section class="mx-auto max-w-3xl px-4 py-16 sm:px-6 lg:px-8">
      <template x-if="$store.invoice.viewer.notFound">
        <div class="rounded-3xl border border-dashed border-slate-200 bg-white p-12 text-center">
          <i class="fas fa-circle-xmark text-3xl text-rose-400"></i>
          <h1 class="mt-4 text-2xl font-semibold text-slate-900">Receipt not found</h1>
          <p class="mt-2 text-sm text-slate-600">This receipt is no longer available.</p>
        </div>
      </template>
      <template x-if="!$store.invoice.viewer.notFound && $store.invoice.viewer.invoice && $store.invoice.viewer.payment">
        <div class="space-y-6 rounded-3xl border border-slate-200 bg-white p-10 shadow-xl">
          <header class="flex flex-wrap items-center justify-between gap-4">
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Payment receipt</p>
              <h1 class="text-2xl font-bold text-slate-900" x-text="$store.invoice.viewer.invoice?.branding.businessName"></h1>
              <p class="text-sm text-slate-600" x-text="$store.invoice.viewer.invoice?.branding.businessAddress"></p>
            </div>
            <div class="text-right text-sm text-slate-600">
              <p>
                Receipt #
                <span class="font-semibold text-slate-900" x-text="$store.invoice.viewer.payment?.receiptNumber || $store.invoice.viewer.payment?.id"></span>
              </p>
              <p>
                Invoice #
                <span class="font-semibold text-slate-900" x-text="$store.invoice.viewer.invoice?.number"></span>
              </p>
            </div>
          </header>

          <div class="grid gap-6 md:grid-cols-2">
            <div class="rounded-2xl border border-slate-100 bg-slate-50 p-5">
              <h2 class="text-xs font-semibold uppercase tracking-wide text-slate-500">Paid by</h2>
              <p class="mt-3 text-base font-semibold text-slate-900" x-text="$store.invoice.viewer.invoice?.client.company || $store.invoice.viewer.invoice?.client.name"></p>
              <p class="text-sm text-slate-600" x-text="$store.invoice.viewer.invoice?.client.address"></p>
              <p class="text-xs text-slate-500" x-text="$store.invoice.viewer.invoice?.client.email"></p>
            </div>
            <div class="rounded-2xl border border-slate-100 bg-white p-5">
              <h2 class="text-xs font-semibold uppercase tracking-wide text-slate-500">Payment details</h2>
              <dl class="mt-3 space-y-2 text-sm text-slate-600">
                <div class="flex items-center justify-between">
                  <dt>Date</dt>
                  <dd class="font-semibold text-slate-900" x-text="new Date($store.invoice.viewer.payment?.date ?? '').toLocaleDateString()"></dd>
                </div>
                <div class="flex items-center justify-between">
                  <dt>Amount</dt>
                  <dd class="font-semibold text-slate-900" x-text="$store.invoice.formatCurrency($store.invoice.viewer.payment?.amount ?? 0, $store.invoice.viewer.invoice?.currency)"></dd>
                </div>
                <div class="flex items-center justify-between">
                  <dt>Method</dt>
                  <dd class="font-semibold text-slate-900" x-text="$store.invoice.viewer.payment?.method"></dd>
                </div>
                <template x-if="$store.invoice.viewer.payment?.note">
                  <div class="flex items-start justify-between gap-6">
                    <dt>Note</dt>
                    <dd class="flex-1 text-right" x-text="$store.invoice.viewer.payment?.note"></dd>
                  </div>
                </template>
              </dl>
            </div>
          </div>

          <section class="rounded-2xl border border-slate-100 bg-slate-50 p-5 text-sm text-slate-600">
            <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500">Invoice balance</h3>
            <dl class="mt-3 space-y-2">
              <div class="flex items-center justify-between">
                <dt>Total invoice amount</dt>
                <dd class="font-semibold text-slate-900" x-text="$store.invoice.formatCurrency($store.invoice.viewer.invoice?.totals.grandTotal ?? 0, $store.invoice.viewer.invoice?.currency)"></dd>
              </div>
              <div class="flex items-center justify-between">
                <dt>Total paid</dt>
                <dd class="font-semibold text-slate-900" x-text="$store.invoice.formatCurrency($store.invoice.viewer.invoice?.totals.paidTotal ?? 0, $store.invoice.viewer.invoice?.currency)"></dd>
              </div>
              <div class="flex items-center justify-between">
                <dt>Balance remaining</dt>
                <dd class="font-semibold" :class="$store.invoice.viewer.invoice?.totals.balanceDue <= 0 ? 'text-emerald-600' : 'text-slate-700'" x-text="$store.invoice.formatCurrency($store.invoice.viewer.invoice?.totals.balanceDue ?? 0, $store.invoice.viewer.invoice?.currency)"></dd>
              </div>
            </dl>
          </section>

          <p class="text-xs text-slate-500">
            This receipt confirms the payment for the invoice listed above. Please keep it for your records.
          </p>
        </div>
      </template>
    </section>
  </main>
</Layout>
