---
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/Button.astro';
import SectionHeading from '../../components/SectionHeading.astro';

const planFilters = [
  { value: 'all', label: 'All plans' },
  { value: 'free', label: 'Free only' },
  { value: 'pro', label: 'Pro only' },
] as const;

const scoreFilters = [
  { value: 'all', label: 'All scores' },
  { value: '80+', label: '80%+' },
  { value: '90+', label: '90%+' },
] as const;
---

<Layout>
  <a
    class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:rounded-md focus:bg-white focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    href="#linkedin-bio-history"
  >
    Skip to LinkedIn Bio history
  </a>
  <main
    id="linkedin-bio-history"
    class="min-h-screen bg-slate-50"
    x-data="() => ({ linkedinBio: $store.linkedinBio })"
    x-init="linkedinBio.initHistory()"
  >
    <section class="relative overflow-hidden py-16 sm:py-20">
      <div class="absolute inset-0 bg-gradient-to-br from-indigo-100 via-white to-transparent"></div>
      <div class="relative mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
        <div class="space-y-6 text-center">
          <span class="inline-flex items-center gap-2 rounded-full bg-indigo-100 px-4 py-1.5 text-sm font-semibold text-indigo-700">
            <i class="fas fa-clock-rotate-left text-xs"></i>
            LinkedIn Bio Optimizer · History
          </span>
          <h1 class="text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">Saved profiles and versions</h1>
          <p class="text-base text-slate-600 sm:text-lg">
            Review every generation, lint run, and export event. Filter by plan gating, score, or search to pinpoint the variant you need.
          </p>
          <div class="flex flex-wrap justify-center gap-3 text-xs text-slate-500">
            <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 font-semibold text-slate-600 shadow-sm">
              <i class="fas fa-database text-[10px] text-indigo-500"></i>
              <span x-text="`${linkedinBio.historyRecords.length} total versions`"></span>
            </span>
            <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 font-semibold text-slate-600 shadow-sm">
              <i class="fas fa-rocket text-[10px] text-indigo-500"></i>
              Last generated <span x-text="new Date(linkedinBio.state.usage.lastGeneratedAt).toLocaleString()"></span>
            </span>
          </div>
          <div class="flex flex-wrap justify-center gap-3">
            <Button variant="outline" href="/linkedin-bio">
              <i class="fas fa-arrow-left text-xs"></i>
              Back to overview
            </Button>
            <Button
              variant="ghost"
              x-bind:href="`/linkedin-bio/editor/${linkedinBio.activeProfile?.id ?? ''}`"
            >
              <i class="fas fa-sliders text-xs"></i>
              Open editor
            </Button>
          </div>
        </div>
      </div>
    </section>

    <section class="pb-20">
      <div class="mx-auto max-w-6xl space-y-10 px-4 sm:px-6 lg:px-8">
        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <div class="grid gap-4 lg:grid-cols-[minmax(0,0.6fr)_minmax(0,1.4fr)]">
            <div class="space-y-4">
              <SectionHeading
                eyebrow="Filters"
                title="Slice by plan, score, or keyword"
                description="Use quick filters to find saved variants. Plan gating is enforced per profile."
              />
              <div class="space-y-3 text-xs text-slate-600">
                <label class="flex flex-col gap-1">
                  <span class="font-semibold text-slate-700">Plan</span>
                  <select
                    class="rounded-lg border border-slate-200 bg-white px-3 py-2 font-semibold text-slate-700 focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                    x-model="linkedinBio.state.filters.history.plan"
                    @change="linkedinBio.setHistoryFilter('plan', $event.target.value)"
                  >
                    <template x-for="filter in ${JSON.stringify(planFilters)}" :key="filter.value">
                      <option :value="filter.value" x-text="filter.label"></option>
                    </template>
                  </select>
                </label>
                <label class="flex flex-col gap-1">
                  <span class="font-semibold text-slate-700">Score</span>
                  <select
                    class="rounded-lg border border-slate-200 bg-white px-3 py-2 font-semibold text-slate-700 focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                    x-model="linkedinBio.state.filters.history.score"
                    @change="linkedinBio.setHistoryFilter('score', $event.target.value)"
                  >
                    <template x-for="filter in ${JSON.stringify(scoreFilters)}" :key="filter.value">
                      <option :value="filter.value" x-text="filter.label"></option>
                    </template>
                  </select>
                </label>
                <label class="flex flex-col gap-1">
                  <span class="font-semibold text-slate-700">Search</span>
                  <input
                    type="search"
                    placeholder="Profile or note keyword…"
                    class="rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                    x-model="linkedinBio.state.filters.history.search"
                    @input.debounce.300ms="linkedinBio.setHistorySearch($event.target.value)"
                  />
                </label>
                <div class="rounded-2xl border border-indigo-100 bg-indigo-50/70 p-4 text-xs text-indigo-800">
                  <p class="font-semibold">Tip</p>
                  <p class="mt-1">Use plan = Pro to highlight variants with Markdown+PDF exports, localization packs, and advanced linting.</p>
                </div>
              </div>
            </div>
            <div class="space-y-4">
              <header class="flex flex-wrap items-center justify-between gap-3">
                <div>
                  <p class="text-xs font-semibold uppercase tracking-[0.35em] text-indigo-500">History</p>
                  <h2 class="text-lg font-semibold text-slate-900">Saved variants</h2>
                </div>
                <p class="text-xs text-slate-500">
                  Showing <span class="font-semibold text-slate-700" x-text="linkedinBio.filteredHistory.length"></span> records
                </p>
              </header>
              <template x-if="linkedinBio.filteredHistory.length === 0">
                <p class="rounded-2xl border border-slate-200 bg-slate-50/70 px-4 py-6 text-center text-sm text-slate-500">
                  No records match your filters yet. Try broadening the criteria or generate a new variant.
                </p>
              </template>
              <div class="space-y-3">
                <template x-for="record in linkedinBio.filteredHistory" :key="record.id">
                  <article class="space-y-3 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                      <div>
                        <h3 class="text-sm font-semibold text-slate-900" x-text="record.profileTitle"></h3>
                        <p class="text-xs text-slate-500" x-text="new Date(record.savedAt).toLocaleString()"></p>
                      </div>
                      <div class="flex flex-wrap items-center gap-2 text-[11px] text-slate-500">
                        <span class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1 font-semibold">
                          <i class="fas fa-star text-[9px] text-indigo-500"></i>
                          <span x-text="`${record.score}%`"></span>
                        </span>
                        <span class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1 font-semibold">
                          <i class="fas fa-key text-[9px] text-indigo-500"></i>
                          <span x-text="`${record.keywordsCovered} keywords`"></span>
                        </span>
                        <span class="inline-flex items-center gap-1 rounded-full px-3 py-1 font-semibold" :class="record.planRequired === 'pro' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'">
                          <i class="fas fa-bolt text-[9px]"></i>
                          <span x-text="record.planRequired === 'pro' ? 'Pro' : 'Free'"></span>
                        </span>
                      </div>
                    </div>
                    <p class="text-sm text-slate-600" x-text="record.note"></p>
                    <div class="flex flex-wrap items-center gap-2 text-xs text-slate-500">
                      <span>Persona:</span>
                      <span class="rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-600" x-text="record.persona === 'first' ? 'First person' : 'Third person'"></span>
                      <span>Exports:</span>
                      <span class="rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-600" x-text="record.exported.join(', ').toUpperCase()"></span>
                    </div>
                    <div class="flex flex-wrap gap-2">
                      <Button
                        size="sm"
                        variant="outline"
                        x-bind:href="`/linkedin-bio/editor/${record.profileId}`"
                      >
                        <i class="fas fa-sliders text-[10px]"></i>
                        Open in editor
                      </Button>
                      <Button size="sm" variant="ghost">
                        <i class="fas fa-file-export text-[10px]"></i>
                        Request export
                      </Button>
                    </div>
                    <template x-if="record.planRequired === 'pro' && linkedinBio.state.plan !== 'pro'">
                      <p class="rounded-2xl border border-emerald-200 bg-emerald-50/70 px-3 py-2 text-xs font-semibold text-emerald-700">
                        Upgrade to Pro to access this version’s PDF export, localization, and authenticity linting trail.
                      </p>
                    </template>
                  </article>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>
