---
import Button from "../../components/Button.astro";
---
<section class="space-y-6 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
  <header class="flex items-center justify-between">
    <div>
      <h2 class="text-lg font-semibold text-slate-900">Versions and publishing</h2>
      <p class="text-sm text-slate-600">Restore earlier drafts and grab your public link once you publish.</p>
    </div>
    <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
      <i class="fas fa-wand-magic-sparkles text-[10px]"></i>
      <span x-text="$store['blog-writer'].state.aiUsage.expand + $store['blog-writer'].state.aiUsage.rewrite + $store['blog-writer'].state.aiUsage.seo"></span>
      AI assists
    </span>
  </header>
  <div class="space-y-4">
    <div class="space-y-2">
      <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Share link</p>
      <template x-if="$store['blog-writer'].builder.shareUrl">
        <a
          class="inline-flex items-center gap-2 text-sm font-semibold text-indigo-600 hover:text-indigo-500"
          :href="$store['blog-writer'].builder.shareUrl"
          target="_blank"
          rel="noopener noreferrer"
        >
          <i class="fas fa-link text-xs"></i>
          <span x-text="$store['blog-writer'].builder.shareUrl"></span>
        </a>
      </template>
      <template x-if="!$store['blog-writer'].builder.shareUrl">
        <p class="rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-3 text-xs text-slate-500">
          Publish the post to generate a canonical link. Pro removes the Ansiversa footer.
        </p>
      </template>
    </div>
    <div class="space-y-2">
      <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Version history</p>
      <template x-if="$store['blog-writer'].builder.record.versions.length === 0">
        <p class="rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-500">
          Save snapshots as you iterate to compare structure or restore experiments.
        </p>
      </template>
      <ul class="space-y-3">
        <template x-for="version in $store['blog-writer'].builder.record.versions" :key="version.id">
          <li class="flex items-center justify-between gap-3 rounded-2xl border border-slate-100 bg-white p-3 shadow-sm">
            <div class="space-y-1 text-sm text-slate-600">
              <p class="font-semibold text-slate-900" x-text="version.label"></p>
              <p class="text-xs text-slate-500">
                <span x-text="$store['blog-writer'].formatDate(version.createdAt)"></span> â€¢
                <span x-text="version.wordCount"></span> words
              </p>
              <p class="text-xs text-slate-500" x-text="version.diffSummary"></p>
            </div>
            <Button type="button" size="sm" variant="light" @click.prevent="$store['blog-writer'].restoreVersion(version.id)">
              <i class="fas fa-rotate-left text-xs"></i>
              Restore
            </Button>
          </li>
        </template>
      </ul>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-xs text-slate-600">
      <p class="font-semibold text-slate-900">Plan limits</p>
      <p class="mt-1">
        <strong>Free plan:</strong> up to 5 drafts, 1 publish/month, watermark on exports.
      </p>
      <p class="mt-1">
        <strong>Pro plan:</strong> unlimited drafts, advanced SEO scoring, custom domain embeds.
      </p>
      <div class="mt-3">
        <Button type="button" size="sm" variant="outline" @click.prevent="$store['blog-writer'].setPlan('pro')">
          <i class="fas fa-rocket text-xs"></i>
          Upgrade to pro
        </Button>
      </div>
    </div>
  </div>
</section>
