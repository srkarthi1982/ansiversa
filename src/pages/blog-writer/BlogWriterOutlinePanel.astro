---
import Button from "../../components/Button.astro";
---
<section class="space-y-6 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
  <header class="flex flex-col gap-2">
    <div class="flex items-center justify-between gap-2">
      <h2 class="text-lg font-semibold text-slate-900">Outline and structure</h2>
      <div class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
        <i class="fas fa-diagram-project text-[10px]"></i>
        <span x-text="$store['blog-writer'].builder.record.outline.length"></span>
        sections
      </div>
    </div>
    <p class="text-sm text-slate-600">
      Shape the hierarchy. Expand a section to draft paragraphs, bullets, or code blocks with AI support.
    </p>
  </header>
  <div class="space-y-4">
    <template x-if="$store['blog-writer'].builder.record.outline.length === 0">
      <div class="rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-500">
        Generate an outline from an idea or add sections manually.
      </div>
    </template>
    <div class="space-y-3">
      <template x-for="node in $store['blog-writer'].builder.record.outline" :key="node.id">
        <div class="space-y-2 rounded-2xl border border-slate-200 p-4" :class="$store['blog-writer'].builder.selectedOutlineId === node.id ? 'border-indigo-300 bg-indigo-50/50' : 'bg-white'">
          <div class="flex items-start justify-between gap-2">
            <div class="flex-1 space-y-2">
              <input
                type="text"
                class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-900 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100"
                :value="node.title"
                @focus="$store['blog-writer'].selectOutlineNode(node.id)"
                @input.debounce.400ms="$store['blog-writer'].updateOutlineTitle(node.id, $event.target.value)"
              />
              <div class="flex flex-wrap gap-2">
                <Button type="button" size="sm" variant="light" @click.prevent="$store['blog-writer'].selectOutlineNode(node.id); $store['blog-writer'].insertOutlineNode('before')">
                  <i class="fas fa-plus text-xs"></i>
                  Before
                </Button>
                <Button type="button" size="sm" variant="light" @click.prevent="$store['blog-writer'].selectOutlineNode(node.id); $store['blog-writer'].insertOutlineNode('after')">
                  <i class="fas fa-arrow-down text-xs"></i>
                  After
                </Button>
                <Button type="button" size="sm" variant="light" @click.prevent="$store['blog-writer'].selectOutlineNode(node.id); $store['blog-writer'].insertOutlineNode('child')">
                  <i class="fas fa-indent text-xs"></i>
                  Child
                </Button>
                <Button type="button" size="sm" variant="ghost" class="text-rose-600 hover:bg-rose-50" @click.prevent="$store['blog-writer'].removeOutlineNode(node.id)">
                  <i class="fas fa-trash-can text-xs"></i>
                  Remove
                </Button>
              </div>
            </div>
            <div class="flex flex-col gap-2">
              <Button type="button" size="sm" variant="outline" @click.prevent="$store['blog-writer'].expandOutlineNode(node.id, 'paragraphs')">
                <i class="fas fa-align-left text-xs"></i>
                Paragraphs
              </Button>
              <Button type="button" size="sm" variant="outline" @click.prevent="$store['blog-writer'].expandOutlineNode(node.id, 'bullets')">
                <i class="fas fa-list text-xs"></i>
                Bullets
              </Button>
              <Button type="button" size="sm" variant="outline" @click.prevent="$store['blog-writer'].expandOutlineNode(node.id, 'code')">
                <i class="fas fa-code text-xs"></i>
                Code block
              </Button>
            </div>
          </div>
          <template x-if="node.children && node.children.length">
            <div class="space-y-2 rounded-2xl border border-slate-100 bg-slate-50 p-3">
              <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Sub-points</p>
              <template x-for="child in node.children" :key="child.id">
                <div class="flex items-center gap-2">
                  <i class="fas fa-ellipsis text-xs text-slate-400"></i>
                  <input
                    type="text"
                    class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs text-slate-600 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100"
                    :value="child.title"
                    @input.debounce.300ms="$store['blog-writer'].updateOutlineTitle(child.id, $event.target.value)"
                  />
                </div>
              </template>
            </div>
          </template>
        </div>
      </template>
    </div>
  </div>
</section>
