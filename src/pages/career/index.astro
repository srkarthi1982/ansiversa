---
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/Button.astro';
---
<Layout>
  <a
    class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:rounded-md focus:bg-white focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    href="#career-dashboard"
  >
    Skip to content
  </a>
  <main
    id="career-dashboard"
    class="bg-slate-50 min-h-screen"
    x-data="() => ({ career: $store.career })"
    x-init="career.initDashboard(); career.initRoles();"
  >
    <section class="relative overflow-hidden py-16 sm:py-20">
      <div class="absolute inset-0 bg-gradient-to-br from-indigo-100 via-slate-50 to-transparent"></div>
      <div class="relative mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
        <div class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr] lg:items-center">
          <div class="space-y-6 text-center lg:text-left">
            <span class="inline-flex items-center gap-2 rounded-full bg-indigo-100 px-4 py-1.5 text-sm font-semibold text-indigo-700">
              <i class="fas fa-compass text-xs"></i>
              Career Planner Studio
            </span>
            <h1 class="text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">
              Plan your next role with guided AI playbooks
            </h1>
            <p class="text-base text-slate-600 sm:text-lg">
              Assess your skills, map target roles, and turn learning into a 90-day execution sprint. Builder, tracker, projects, and exports all live in one connected workspace.
            </p>
            <div class="flex flex-wrap justify-center gap-3 lg:justify-start">
              <Button type="button" class="shadow-sm" @click.prevent="career.createPlan()">
                <i class="fas fa-plus text-xs"></i>
                New career plan
              </Button>
              <Button href="/career/builder" variant="outline">
                <i class="fas fa-sliders text-xs"></i>
                Open builder
              </Button>
              <Button href="/career/roles" variant="ghost">
                <i class="fas fa-briefcase text-xs"></i>
                Explore roles
              </Button>
            </div>
            <div class="flex flex-wrap justify-center gap-3 text-xs text-slate-600 lg:justify-start">
              <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1.5 font-semibold shadow-sm">
                <i class="fas fa-wand-magic-sparkles text-[11px] text-indigo-500"></i>
                Guided AI workflows
              </span>
              <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1.5 font-semibold shadow-sm">
                <i class="fas fa-shield-check text-[11px] text-emerald-500"></i>
                Private by default
              </span>
            </div>
          </div>
          <div class="relative">
            <div class="absolute inset-0 translate-x-6 translate-y-6 rounded-3xl bg-indigo-200 opacity-40 blur-2xl"></div>
            <div class="relative grid gap-4 rounded-3xl border border-slate-200 bg-white/90 p-6 shadow-xl backdrop-blur">
              <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-slate-900">This week's momentum</h2>
                <span class="inline-flex items-center gap-2 rounded-full bg-indigo-100 px-3 py-1 text-xs font-semibold text-indigo-700">
                  <i class="fas fa-rocket text-[11px]"></i>
                  Sprint focus
                </span>
              </div>
              <dl class="grid gap-4 sm:grid-cols-2">
                <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                  <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Active plans</dt>
                  <dd class="mt-2 text-2xl font-semibold text-slate-900" x-text="career.dashboard.data?.metrics.activePlans ?? 0"></dd>
                </div>
                <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                  <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Applications this week</dt>
                  <dd class="mt-2 text-2xl font-semibold text-slate-900" x-text="career.dashboard.data?.metrics.applicationsThisWeek ?? 0"></dd>
                </div>
                <div class="rounded-2xl border border-indigo-100 bg-indigo-50/60 p-4 sm:col-span-2">
                  <dt class="text-xs font-medium uppercase tracking-wide text-indigo-700">AI usage</dt>
                  <dd class="mt-2 flex items-center gap-3 text-sm text-indigo-700">
                    <span class="text-xl font-semibold text-indigo-900" x-text="career.dashboard.data ? `${career.dashboard.data.metrics.aiCallsUsed}/${career.dashboard.data.metrics.aiLimit}` : '0/0'"></span>
                    <span>AI calls used today</span>
                  </dd>
                </div>
              </dl>
              <div class="rounded-2xl border border-slate-100 bg-white/70 p-4">
                <h3 class="text-sm font-semibold text-slate-900">Highlights</h3>
                <ul class="mt-3 space-y-2 text-xs text-slate-600">
                  <template x-for="highlight in career.dashboard.data?.highlights ?? []" :key="highlight">
                    <li class="flex items-start gap-2">
                      <i class="fas fa-sparkles mt-1 text-[11px] text-indigo-500"></i>
                      <span x-text="highlight"></span>
                    </li>
                  </template>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="pb-20">
      <div class="mx-auto max-w-6xl space-y-12 px-4 sm:px-6 lg:px-8">
        <div class="grid gap-10 lg:grid-cols-[minmax(0,1fr)_320px]">
          <div class="space-y-6">
            <header class="flex flex-wrap items-center justify-between gap-4">
              <div>
                <h2 class="text-2xl font-semibold text-slate-900">Your career plans</h2>
                <p class="text-sm text-slate-600">Track progress, next reviews, and open the builder in one click.</p>
              </div>
              <Button type="button" variant="outline" class="shadow-sm" @click.prevent="career.createPlan()">
                <i class="fas fa-plus text-xs"></i>
                Start new plan
              </Button>
            </header>
            <div class="grid gap-4" role="list">
              <template x-if="(career.dashboard.data?.plans?.length ?? 0) === 0">
                <div class="rounded-2xl border border-dashed border-slate-200 bg-white p-8 text-center text-sm text-slate-600">
                  <p>You're all set to begin. Create your first plan to unlock the guided builder, learning modules, and trackers.</p>
                </div>
              </template>
              <template x-for="plan in career.dashboard.data?.plans ?? []" :key="plan.id">
                <article
                  class="group relative rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg"
                >
                  <div class="flex flex-wrap items-start justify-between gap-3">
                    <div>
                      <h3 class="text-lg font-semibold text-slate-900" x-text="plan.title"></h3>
                      <p class="text-sm text-slate-600">
                        Target role:
                        <span class="font-medium capitalize" x-text="plan.targetRoleId.replaceAll('_',' ') || 'TBD'"></span>
                      </p>
                    </div>
                    <span
                      class="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold"
                      :class="plan.status === 'published' ? 'border-emerald-200 bg-emerald-50 text-emerald-700' : 'border-slate-200 bg-slate-50 text-slate-600'"
                    >
                      <i class="fas" :class="plan.status === 'published' ? 'fa-globe' : 'fa-pen-to-square'"></i>
                      <span class="capitalize" x-text="plan.status"></span>
                    </span>
                  </div>
                  <div class="mt-4 grid gap-4 sm:grid-cols-3">
                    <div>
                      <dt class="text-xs uppercase tracking-wide text-slate-500">Progress</dt>
                      <dd class="mt-1 flex items-center gap-3">
                        <div class="relative h-2 flex-1 rounded-full bg-slate-100">
                          <div class="absolute inset-y-0 left-0 rounded-full bg-indigo-500 transition-all" :style="`width: ${plan.progress}%`"></div>
                        </div>
                        <span class="text-sm font-semibold text-slate-900" x-text="`${plan.progress}%`"></span>
                      </dd>
                    </div>
                    <div>
                      <dt class="text-xs uppercase tracking-wide text-slate-500">Next review</dt>
                      <dd class="mt-1 text-sm font-medium text-slate-900" x-text="plan.nextReviewAt ? new Date(plan.nextReviewAt).toLocaleDateString() : 'Set date'"></dd>
                    </div>
                    <div>
                      <dt class="text-xs uppercase tracking-wide text-slate-500">Tasks due</dt>
                      <dd class="mt-1 text-sm font-medium text-slate-900" x-text="plan.tasksDue"></dd>
                    </div>
                  </div>
                  <div class="mt-5 flex flex-wrap items-center gap-3 text-xs text-slate-500">
                    <span>Last saved <span x-text="career.formatRelative(plan.lastSavedAt)"></span></span>
                    <span>â€¢</span>
                    <span>Created <span x-text="new Date(plan.createdAt).toLocaleDateString()"></span></span>
                  </div>
                  <div class="mt-5 flex flex-wrap gap-3">
                    <Button :href="`/career/builder?id=${plan.id}`" size="sm">
                      <i class="fas fa-pen text-[11px]"></i>
                      Open plan
                    </Button>
                    <Button size="sm" variant="outline" @click.prevent="career.duplicatePlan(plan.id)">
                      <i class="fas fa-clone text-[11px]"></i>
                      Duplicate
                    </Button>
                    <Button size="sm" variant="ghost" class="text-red-600" @click.prevent="career.deletePlan(plan.id)">
                      <i class="fas fa-trash text-[11px]"></i>
                      Delete
                    </Button>
                  </div>
                </article>
              </template>
            </div>
          </div>
          <aside class="space-y-6 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
            <div>
              <h3 class="text-base font-semibold text-slate-900">Tasks this week</h3>
              <ul class="mt-4 space-y-3 text-sm text-slate-600">
                <template x-for="task in career.dashboard.data?.tasks ?? []" :key="task.id">
                  <li class="flex items-start gap-3 rounded-2xl border border-slate-100 bg-slate-50/80 p-3">
                    <span class="mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-semibold"
                      :class="{
                        'bg-indigo-100 text-indigo-700': task.type === 'learning',
                        'bg-emerald-100 text-emerald-700': task.type === 'project',
                        'bg-amber-100 text-amber-700': task.type === 'application',
                        'bg-sky-100 text-sky-700': task.type === 'networking',
                      }"
                    >
                      <i class="fas" :class="{
                          'fa-book-open': task.type === 'learning',
                          'fa-diagram-project': task.type === 'project',
                          'fa-paper-plane': task.type === 'application',
                          'fa-user-group': task.type === 'networking',
                        }"></i>
                    </span>
                    <div class="space-y-1">
                      <p class="font-semibold text-slate-900" x-text="task.title"></p>
                      <p class="text-xs text-slate-500" x-text="`Due ${new Date(task.dueOn).toLocaleDateString()}`"></p>
                    </div>
                  </li>
                </template>
              </ul>
            </div>
            <div>
              <h3 class="text-base font-semibold text-slate-900">Application pipeline</h3>
              <dl class="mt-4 grid gap-3 text-sm">
                <template x-for="(count, status) in career.dashboard.data?.applications.byStatus ?? {}" :key="status">
                  <div class="flex items-center justify-between rounded-2xl border border-slate-100 bg-slate-50/70 px-3 py-2">
                    <dt class="capitalize text-slate-600" x-text="status.replace('-', ' ')"></dt>
                    <dd class="font-semibold text-slate-900" x-text="count"></dd>
                  </div>
                </template>
              </dl>
              <Button href="/career/tracker" variant="outline" size="sm" class="mt-4 w-full">
                <i class="fas fa-table-list text-[11px]"></i>
                Open tracker
              </Button>
            </div>
          </aside>
        </div>

        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div>
              <h2 class="text-2xl font-semibold text-slate-900">Role explorer</h2>
              <p class="text-sm text-slate-600">Browse seeded roles with skills, demand, and salary insights.</p>
            </div>
            <Button href="/career/roles" variant="outline" size="sm">
              View all roles
              <i class="fas fa-arrow-right text-[11px]"></i>
            </Button>
          </div>
          <div class="mt-6 grid gap-4 md:grid-cols-3">
            <template x-for="role in (career.roles.items.slice(0,3))" :key="role.id">
              <article class="rounded-2xl border border-slate-200 bg-slate-50/70 p-5">
                <header class="flex items-start justify-between gap-3">
                  <div>
                    <h3 class="text-lg font-semibold text-slate-900" x-text="role.title"></h3>
                    <p class="text-xs uppercase tracking-wide text-slate-500" x-text="role.category"></p>
                  </div>
                  <span
                    class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold"
                    :class="{
                      'bg-emerald-100 text-emerald-700': role.demandLevel === 'high',
                      'bg-amber-100 text-amber-700': role.demandLevel === 'med',
                      'bg-slate-100 text-slate-600': role.demandLevel === 'low',
                    }"
                  >
                    <i class="fas fa-signal text-[11px]"></i>
                    <span class="capitalize" x-text="role.demandLevel"></span>
                  </span>
                </header>
                <p class="mt-3 text-sm text-slate-600" x-text="role.summary"></p>
                <div class="mt-4 text-xs">
                  <h4 class="font-semibold text-slate-900">Key skills</h4>
                  <ul class="mt-2 flex flex-wrap gap-2">
                    <template x-for="skill in role.skills.slice(0,5)" :key="skill">
                      <li class="rounded-full bg-white px-3 py-1 font-medium text-slate-600">
                        <span x-text="skill.replace('-', ' ')"></span>
                      </li>
                    </template>
                  </ul>
                </div>
              </article>
            </template>
            <template x-if="!(career.roles.items.length)">
              <p class="col-span-full rounded-2xl border border-dashed border-slate-200 bg-slate-50/70 p-5 text-sm text-slate-600">
                View the full library to unlock seeded roles, salary ranges, and skill breakdowns tailored for transitioning professionals.
              </p>
            </template>
          </div>
        </section>
      </div>
    </section>
  </main>
</Layout>
