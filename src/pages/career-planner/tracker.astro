---
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/Button.astro';
---
<Layout>
  <a
    class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:rounded-md focus:bg-white focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    href="#career-tracker"
  >
    Skip to content
  </a>
  <main
    id="career-tracker"
    class="bg-slate-50 min-h-screen"
    x-data="() => ({ career: $store.career })"
    x-init="career.initTracker()"
  >
    <section class="border-b border-slate-200 bg-white/90 py-12 shadow-sm">
      <div class="mx-auto flex max-w-6xl flex-col gap-6 px-4 sm:px-6 lg:px-8">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <div class="space-y-2">
            <div class="inline-flex items-center gap-2 rounded-full bg-indigo-100 px-4 py-1.5 text-xs font-semibold text-indigo-700">
              <i class="fas fa-table-list text-[11px]"></i>
              Applications tracker
            </div>
            <h1 class="text-3xl font-bold text-slate-900 sm:text-4xl">Stay on top of outreach &amp; interviews</h1>
            <p class="text-sm text-slate-600 sm:text-base">Log every application, follow-up, and interview. Filter by stage, prepare notes, and export summaries.</p>
          </div>
          <Button type="button" variant="outline" class="shadow-sm" @click.prevent="career.initDashboard(); window.location.href='/career-planner';">
            <i class="fas fa-arrow-left text-[11px]"></i>
            Back to dashboard
          </Button>
        </div>
        <div class="grid gap-4 rounded-3xl border border-slate-200 bg-white p-5 shadow-sm md:grid-cols-[minmax(0,1fr)_220px]">
          <label class="flex items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-600">
            <i class="fas fa-magnifying-glass text-xs"></i>
            <input
              type="search"
              class="w-full bg-transparent focus:outline-none"
              placeholder="Search company or role"
              x-model="career.tracker.filters.search"
            />
          </label>
          <label class="flex items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-600">
            <i class="fas fa-filter text-xs"></i>
            <select
              class="w-full bg-transparent focus:outline-none"
              x-model="career.tracker.filters.status"
            >
              <option value="all">All statuses</option>
              <option value="wishlist">Wishlist</option>
              <option value="applied">Applied</option>
              <option value="interview">Interview</option>
              <option value="offer">Offer</option>
              <option value="rejected">Rejected</option>
            </select>
          </label>
        </div>
      </div>
    </section>

    <section class="py-12">
      <div class="mx-auto max-w-6xl space-y-6 px-4 sm:px-6 lg:px-8">
        <div class="overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-sm">
          <table class="min-w-full divide-y divide-slate-200 text-sm">
            <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
              <tr>
                <th class="px-4 py-3 text-left">Company</th>
                <th class="px-4 py-3 text-left">Role</th>
                <th class="px-4 py-3 text-left">Status</th>
                <th class="px-4 py-3 text-left">Applied on</th>
                <th class="px-4 py-3 text-left">Next step</th>
                <th class="px-4 py-3 text-left">Notes</th>
                <th class="px-4 py-3 text-right">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-200 bg-white">
              <template x-for="application in career.filteredApplications" :key="application.id">
                <tr class="hover:bg-slate-50">
                  <td class="px-4 py-3 font-semibold text-slate-900" x-text="application.company"></td>
                  <td class="px-4 py-3 text-slate-700">
                    <div class="flex flex-col">
                      <span x-text="application.role"></span>
                      <span class="text-xs text-slate-500" x-text="application.source"></span>
                    </div>
                  </td>
                  <td class="px-4 py-3">
                    <span
                      class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold capitalize"
                      :class="{
                        'bg-slate-100 text-slate-600': application.status === 'wishlist',
                        'bg-sky-100 text-sky-700': application.status === 'applied',
                        'bg-indigo-100 text-indigo-700': application.status === 'interview',
                        'bg-emerald-100 text-emerald-700': application.status === 'offer',
                        'bg-rose-100 text-rose-700': application.status === 'rejected',
                      }"
                    >
                      <i class="fas"
                        :class="{
                          'fa-heart': application.status === 'wishlist',
                          'fa-paper-plane': application.status === 'applied',
                          'fa-calendar-check': application.status === 'interview',
                          'fa-trophy': application.status === 'offer',
                          'fa-xmark': application.status === 'rejected',
                        }"
                      ></i>
                      <span x-text="application.status"></span>
                    </span>
                  </td>
                  <td class="px-4 py-3 text-slate-700" x-text="application.appliedOn ? new Date(application.appliedOn).toLocaleDateString() : '—'"></td>
                  <td class="px-4 py-3 text-slate-700" x-text="application.nextStepOn ? new Date(application.nextStepOn).toLocaleDateString() : '—'"></td>
                  <td class="px-4 py-3 text-slate-600">
                    <span x-text="application.notes ?? 'Add notes'" class="block max-w-[16rem] truncate"></span>
                  </td>
                  <td class="px-4 py-3 text-right">
                    <div class="flex justify-end gap-2 text-xs">
                      <Button
                        size="sm"
                        variant="outline"
                        @click.prevent="career.upsertApplication({ ...application, status: 'interview' })"
                      >
                        Move to interview
                      </Button>
                      <Button size="sm" variant="ghost" class="text-red-600" @click.prevent="career.removeApplication(application.id)">
                        Remove
                      </Button>
                    </div>
                  </td>
                </tr>
              </template>
              <template x-if="career.filteredApplications.length === 0">
                <tr>
                  <td colspan="7" class="px-4 py-10 text-center text-sm text-slate-600">
                    No applications yet. Track companies as wishlist to build momentum and accountability.
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</Layout>
