---
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/Button.astro';
---
<Layout>
  <main
    class="min-h-screen bg-slate-900/5"
    x-data="() => ({ contract: $store.contract, wizard: $store.contract.wizard })"
    x-init="$store.contract.resetWizard()"
  >
    <section class="bg-slate-900 py-16 text-white">
      <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
        <p class="text-xs uppercase tracking-[0.3em] text-white/70">Guided wizard</p>
        <h1 class="mt-3 text-3xl font-semibold sm:text-4xl">Capture essentials and generate a tailored agreement</h1>
        <p class="mt-3 max-w-3xl text-sm text-white/70">
          Answer a few questions about the parties, work scope, and payment terms. We’ll stitch the right clauses, ready for you
          to tweak and share.
        </p>
      </div>
    </section>

    <section class="-mt-16 pb-20">
      <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
        <div class="rounded-3xl border border-slate-200 bg-white shadow-xl">
          <header class="border-b border-slate-100 px-6 py-5">
            <nav class="flex items-center justify-between gap-2 text-xs font-semibold uppercase tracking-wide text-slate-500">
              <template x-for="(label, index) in ['Parties', 'Scope', 'Payment', 'Options', 'Review']" :key="label">
                <div class="flex items-center gap-2">
                  <div
                    class="grid h-8 w-8 place-content-center rounded-full border text-[11px]"
                    :class="wizard.step === index ? 'border-indigo-500 bg-indigo-500 text-white' : wizard.step > index ? 'border-emerald-500 bg-emerald-500 text-white' : 'border-slate-200 bg-white text-slate-500'"
                  >
                    <span x-text="index + 1"></span>
                  </div>
                  <span class="hidden text-slate-600 sm:block" x-text="label"></span>
                  <template x-if="index < 4">
                    <div class="hidden h-px w-8 bg-slate-200 sm:block" :class="wizard.step > index ? 'bg-emerald-400' : ''"></div>
                  </template>
                </div>
              </template>
            </nav>
          </header>
          <div class="px-6 py-8">
            <form class="space-y-8" @submit.prevent="$store.contract.completeWizard()">
              <template x-if="wizard.step === 0">
                <div class="space-y-5">
                  <h2 class="text-xl font-semibold text-slate-900">Party details</h2>
                  <p class="text-sm text-slate-600">Tell us who’s involved so we can personalise the contract intro and signature blocks.</p>
                  <div class="grid gap-4 md:grid-cols-2">
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Client name
                      <input
                        type="text"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        x-model="wizard.data.clientName"
                        required
                      />
                    </label>
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Client address
                      <input
                        type="text"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        x-model="wizard.data.clientAddress"
                      />
                    </label>
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Provider name
                      <input
                        type="text"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        x-model="wizard.data.providerName"
                        required
                      />
                    </label>
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Provider address
                      <input
                        type="text"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        x-model="wizard.data.providerAddress"
                      />
                    </label>
                  </div>
                </div>
              </template>

              <template x-if="wizard.step === 1">
                <div class="space-y-5">
                  <h2 class="text-xl font-semibold text-slate-900">Scope and deliverables</h2>
                  <p class="text-sm text-slate-600">Summarise what work is being delivered so we can enrich the services section.</p>
                  <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                    Scope summary
                    <textarea
                      rows="4"
                      class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      placeholder="Website redesign including discovery, UX, and launch support"
                      x-model="wizard.data.scope"
                      required
                    ></textarea>
                  </label>
                  <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                    Key deliverables
                    <textarea
                      rows="4"
                      class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      placeholder="High-fidelity UI screens, component library, implementation documentation"
                      x-model="wizard.data.deliverables"
                    ></textarea>
                  </label>
                </div>
              </template>

              <template x-if="wizard.step === 2">
                <div class="space-y-5">
                  <h2 class="text-xl font-semibold text-slate-900">Payment and timing</h2>
                  <p class="text-sm text-slate-600">Capture commercial basics. You can adjust inside the builder later.</p>
                  <div class="grid gap-4 md:grid-cols-2">
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Project fee
                      <input
                        type="text"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="12000"
                        x-model="wizard.data.fee"
                        required
                      />
                    </label>
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Currency
                      <input
                        type="text"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm uppercase text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        maxlength="3"
                        x-model="wizard.data.currency"
                      />
                    </label>
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500 md:col-span-2">
                      Payment schedule
                      <input
                        type="text"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="50% upfront, 50% on delivery"
                        x-model="wizard.data.paymentSchedule"
                        required
                      />
                    </label>
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Start date
                      <input
                        type="date"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        x-model="wizard.data.startDate"
                        required
                      />
                    </label>
                    <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                      Target completion
                      <input
                        type="date"
                        class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        x-model="wizard.data.endDate"
                      />
                    </label>
                  </div>
                </div>
              </template>

              <template x-if="wizard.step === 3">
                <div class="space-y-5">
                  <h2 class="text-xl font-semibold text-slate-900">Clause options</h2>
                  <p class="text-sm text-slate-600">Toggle optional protections. You can refine wording later in the builder.</p>
                  <div class="grid gap-4 md:grid-cols-2">
                    <label class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
                      <input type="checkbox" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" x-model="wizard.data.includeConfidentiality" />
                      Include confidentiality clause
                    </label>
                    <label class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
                      <input type="checkbox" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" x-model="wizard.data.includeIpAssignment" />
                      Assign IP to client on payment
                    </label>
                    <label class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
                      <input type="checkbox" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" x-model="wizard.data.includeLiabilityCap" />
                      Include liability cap wording
                    </label>
                    <label class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
                      <span class="text-sm font-semibold text-slate-700">Template</span>
                      <select
                        class="flex-1 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 focus:outline-none"
                        x-model="wizard.data.templateKey"
                      >
                        <template x-for="template in contract.templates" :key="template.key">
                          <option :value="template.key" x-text="template.label"></option>
                        </template>
                      </select>
                    </label>
                  </div>
                  <label class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                    Governing jurisdiction
                    <input
                      type="text"
                      class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      placeholder="Dubai, UAE"
                      x-model="wizard.data.jurisdiction"
                      required
                    />
                  </label>
                </div>
              </template>

              <template x-if="wizard.step === 4">
                <div class="space-y-5">
                  <h2 class="text-xl font-semibold text-slate-900">Review summary</h2>
                  <p class="text-sm text-slate-600">Everything look good? We’ll create a draft and open it in the builder for fine-tuning.</p>
                  <div class="space-y-3 rounded-3xl border border-slate-200 bg-slate-50 p-5 text-sm text-slate-700">
                    <p><strong>Client:</strong> <span x-text="wizard.data.clientName"></span></p>
                    <p><strong>Provider:</strong> <span x-text="wizard.data.providerName"></span></p>
                    <p><strong>Scope:</strong> <span x-text="wizard.data.scope"></span></p>
                    <p><strong>Fee:</strong> <span x-text="wizard.data.fee"></span> (<span x-text="wizard.data.currency"></span>)</p>
                    <p><strong>Schedule:</strong> <span x-text="wizard.data.paymentSchedule"></span></p>
                    <p><strong>Jurisdiction:</strong> <span x-text="wizard.data.jurisdiction"></span></p>
                    <p><strong>Template:</strong> <span x-text="$store.contract.templateLabel(wizard.data.templateKey)"></span></p>
                  </div>
                  <template x-if="wizard.error">
                    <p class="rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-600" x-text="wizard.error"></p>
                  </template>
                </div>
              </template>

              <div class="flex items-center justify-between border-t border-slate-100 pt-6">
                <Button type="button" variant="ghost" class="text-slate-600 hover:text-slate-800" @click.prevent="contract.prevWizardStep()" :disabled="wizard.step === 0">
                  <i class="fas fa-chevron-left text-xs"></i>
                  Back
                </Button>
                <div class="flex items-center gap-3">
                  <template x-if="wizard.step < 4">
                    <Button type="button" @click.prevent="contract.nextWizardStep()">
                      Next step
                      <i class="fas fa-chevron-right text-xs"></i>
                    </Button>
                  </template>
                  <template x-if="wizard.step === 4">
                    <Button type="submit" :disabled="wizard.busy">
                      <template x-if="!wizard.busy">
                        <span>
                          <i class="fas fa-wand-magic-sparkles text-xs"></i>
                          Generate contract
                        </span>
                      </template>
                      <template x-if="wizard.busy">
                        <span class="inline-flex items-center gap-2">
                          <svg class="h-4 w-4 animate-spin text-white" viewBox="0 0 24 24" fill="none">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                          </svg>
                          Generating...
                        </span>
                      </template>
                    </Button>
                  </template>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>
