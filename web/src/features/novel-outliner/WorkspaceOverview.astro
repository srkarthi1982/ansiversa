---
import { SectionHeading, Button } from '@ansiversa/components';
---
<section class="bg-slate-900 py-16 text-white" x-data="() => ({ novel: $store['novel-outliner'] })">
  <div class="mx-auto max-w-6xl space-y-10 px-4 sm:px-6 lg:px-8">
    <SectionHeading
      eyebrow="Workspace"
      title="Everything your outline needs in one dual-pane hub"
      description="Navigate beats, characters, world lore, scenes, threads, diagnostics, and exports without context switching. Novel Outliner keeps every artifact synced."
      titleClass="mt-3 text-3xl font-bold tracking-tight sm:text-4xl text-white"
      descriptionClass="mt-4 text-base text-slate-300"
      eyebrowClass="text-xs font-semibold uppercase tracking-[0.35em] text-indigo-300"
    />
    <div class="grid gap-8 lg:grid-cols-[0.85fr_1.15fr]">
      <aside class="space-y-6">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
          <h3 class="text-sm font-semibold uppercase tracking-[0.3em] text-indigo-200">Panels</h3>
          <ul class="mt-4 space-y-2 text-sm">
            <template x-for="panel in novel.state.workspacePanels" :key="panel.key">
              <li>
                <button
                  type="button"
                  class="flex w-full items-center justify-between rounded-2xl border px-4 py-3 transition"
                  :class="panel.key === novel.state.selectedPanelKey ? 'border-indigo-400 bg-indigo-500/20 text-white' : 'border-white/10 bg-white/5 text-slate-200 hover:border-indigo-400/60'"
                  @click="novel.selectPanel(panel.key)"
                >
                  <span class="inline-flex items-center gap-3">
                    <i class="fa-solid" :class="[panel.icon, 'text-xs text-indigo-200']"></i>
                    <span class="font-semibold" x-text="panel.label"></span>
                  </span>
                  <i class="fa-solid fa-chevron-right text-[10px]"></i>
                </button>
              </li>
            </template>
          </ul>
        </div>
        <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
          <h4 class="text-sm font-semibold uppercase tracking-[0.3em] text-indigo-200">Workspace metrics</h4>
          <dl class="mt-4 grid gap-4 sm:grid-cols-2">
            <div class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3">
              <dt class="text-[11px] uppercase tracking-[0.3em] text-indigo-200">Beats outlined</dt>
              <dd class="mt-2 text-xl font-semibold" x-text="novel.state.workspaceMetrics.beatsOutlined"></dd>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3">
              <dt class="text-[11px] uppercase tracking-[0.3em] text-indigo-200">Scenes planned</dt>
              <dd class="mt-2 text-xl font-semibold" x-text="novel.state.workspaceMetrics.scenesPlanned"></dd>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3">
              <dt class="text-[11px] uppercase tracking-[0.3em] text-indigo-200">Timeline warnings</dt>
              <dd class="mt-2 text-xl font-semibold" x-text="novel.state.workspaceMetrics.timelineWarnings"></dd>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3">
              <dt class="text-[11px] uppercase tracking-[0.3em] text-indigo-200">Thread coverage</dt>
              <dd class="mt-2 text-xl font-semibold" x-text="`${novel.state.workspaceMetrics.threadCoverage}%`"></dd>
            </div>
          </dl>
          <p class="mt-3 text-xs text-indigo-200">POV balance: <span class="font-semibold text-white" x-text="novel.state.workspaceMetrics.povBalance"></span></p>
        </div>
        <div class="rounded-3xl border border-white/10 bg-indigo-500/20 p-6 text-sm text-indigo-100">
          <p class="font-semibold text-white">Export ready?</p>
          <p class="mt-2">Queue Markdown or Pro-exclusive DOCX/FDX/JSON packages. Hand off to Presentation Designer with a single click.</p>
          <div class="mt-4 flex flex-wrap gap-2 text-xs font-semibold uppercase tracking-[0.3em]">
            <template x-for="preset in novel.state.exportPresets" :key="preset.format">
              <button
                type="button"
                class="rounded-full border px-3 py-1"
                :class="[
                  novel.state.exportState.selectedFormat === preset.format ? 'border-white bg-white/20 text-white' : 'border-white/40 bg-white/10 text-indigo-100',
                  preset.plan === 'pro' && novel.plan === 'free' ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer'
                ]"
                @click="novel.selectExportFormat(preset.format)"
              >
                <span x-text="preset.format.toUpperCase()"></span>
              </button>
            </template>
          </div>
          <Button type="button" class="mt-4 shadow-sm" @click.prevent="novel.queueExport()">
            <i class="fa-solid fa-file-export text-xs"></i>
            Queue export
          </Button>
          <p class="mt-2 text-[11px] uppercase tracking-[0.3em]" x-text="novel.state.exportState.status === 'idle' ? 'No export queued' : `Job ${novel.state.exportState.lastJobId} · ${novel.state.exportState.status}`"></p>
        </div>
      </aside>
      <div class="space-y-6">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-indigo-200" x-text="novel.selectedPanelDescription"></p>
          <div class="mt-4 space-y-6 text-sm text-slate-200">
            <template x-if="novel.state.selectedPanelKey === 'beats'">
              <div>
                <template x-if="novel.selectedProject">
                  <div class="space-y-4">
                    <template x-for="act in novel.selectedProject.acts" :key="act.id">
                      <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
                        <div class="flex items-center justify-between gap-3">
                          <h4 class="text-base font-semibold text-white" x-text="act.label"></h4>
                          <span class="text-[11px] uppercase tracking-[0.3em] text-indigo-200" x-text="`${act.beats.length} beats`"></span>
                        </div>
                        <ul class="mt-3 space-y-2">
                          <template x-for="beat in act.beats" :key="beat.id">
                            <li class="rounded-2xl border border-white/10 bg-slate-900/60 px-3 py-2">
                              <div class="flex items-center justify-between">
                                <span class="font-semibold text-white" x-text="beat.label"></span>
                                <span class="text-[11px] uppercase tracking-[0.3em]" x-text="beat.status"></span>
                              </div>
                              <p class="mt-1 text-xs text-slate-300">Words drafted: <span x-text="beat.actualWords.toLocaleString()"></span></p>
                            </li>
                          </template>
                        </ul>
                      </div>
                    </template>
                  </div>
                </template>
              </div>
            </template>

            <template x-if="novel.state.selectedPanelKey === 'characters'">
              <div class="grid gap-3 sm:grid-cols-2">
                <template x-for="character in novel.state.characterRoster" :key="character.id">
                  <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
                    <div class="flex items-center justify-between">
                      <p class="text-base font-semibold text-white" x-text="character.name"></p>
                      <span class="text-[10px] font-semibold uppercase tracking-[0.3em] text-indigo-200" x-text="character.pov ? 'POV' : 'Support'"></span>
                    </div>
                    <p class="mt-1 text-xs text-slate-300" x-text="character.role"></p>
                    <p class="mt-2 text-xs text-slate-400">Goal: <span class="text-slate-100" x-text="character.goal"></span></p>
                    <p class="mt-1 text-xs text-slate-400">Flaw: <span class="text-slate-100" x-text="character.flaw"></span></p>
                    <div class="mt-2 text-[11px] uppercase tracking-[0.3em] text-indigo-200">Relationships</div>
                    <ul class="mt-1 space-y-1 text-xs">
                      <template x-for="rel in character.relationships" :key="rel.id">
                        <li class="rounded-full border border-white/10 bg-white/5 px-3 py-1" x-text="rel.label"></li>
                      </template>
                    </ul>
                  </div>
                </template>
              </div>
            </template>

            <template x-if="novel.state.selectedPanelKey === 'world'">
              <div class="grid gap-3 sm:grid-cols-2">
                <template x-for="entry in novel.state.worldAtlas" :key="entry.id">
                  <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
                    <p class="text-base font-semibold text-white" x-text="entry.name"></p>
                    <p class="mt-1 text-xs text-slate-300" x-text="entry.description"></p>
                    <p class="mt-2 text-xs text-indigo-200">Linked chapters: <span x-text="entry.linkedChapters.join(', ') || '—'"></span></p>
                    <p class="mt-1 text-[11px] uppercase tracking-[0.3em] text-slate-400" x-text="entry.type"></p>
                  </div>
                </template>
              </div>
            </template>

            <template x-if="novel.state.selectedPanelKey === 'timeline'">
              <div class="space-y-4">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <p class="text-sm text-indigo-200">Track chronological vs narrative ordering. Conflicts flag automatically.</p>
                  <Button type="button" variant="ghost" class="text-indigo-200 hover:text-white" @click.prevent="novel.toggleTimelineView()">
                    <i class="fa-solid fa-arrows-rotate text-xs"></i>
                    Toggle view
                  </Button>
                </div>
                <ul class="space-y-3">
                  <template x-for="event in novel.state.timelineEvents" :key="event.id">
                    <li class="rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3">
                      <div class="flex flex-wrap items-center justify-between gap-3">
                        <p class="font-semibold text-white" x-text="event.label"></p>
                        <span class="text-[11px] uppercase tracking-[0.3em] text-indigo-200" x-text="event.order"></span>
                      </div>
                      <p class="mt-1 text-xs text-slate-300">When: <span x-text="new Date(event.when).toLocaleString()"></span></p>
                      <p class="text-xs text-slate-300">POV: <span class="text-slate-100" x-text="event.pov"></span> · Location: <span class="text-slate-100" x-text="event.location"></span></p>
                      <p class="text-xs text-slate-400">Duration: <span x-text="`${event.durationHours}h`"></span> · Chapter: <span x-text="event.chapter"></span></p>
                      <p class="mt-1 text-xs font-semibold text-rose-300" x-show="event.warning" x-text="event.warning"></p>
                    </li>
                  </template>
                </ul>
              </div>
            </template>

            <template x-if="novel.state.selectedPanelKey === 'scenes'">
              <div class="grid gap-3 md:grid-cols-2">
                <template x-for="lane in novel.state.sceneBoard" :key="lane.key">
                  <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
                    <div class="flex items-center justify-between">
                      <p class="text-base font-semibold text-white" x-text="lane.label"></p>
                      <span class="text-[11px] uppercase tracking-[0.3em] text-indigo-200" x-text="`${lane.scenes.length} scenes`"></span>
                    </div>
                    <p class="mt-1 text-xs text-slate-400" x-text="lane.description"></p>
                    <ul class="mt-3 space-y-2 text-xs">
                      <template x-for="scene in lane.scenes" :key="scene.id">
                        <li class="rounded-2xl border border-white/10 bg-white/5 px-3 py-2">
                          <p class="font-semibold text-white" x-text="scene.title"></p>
                          <p class="text-slate-300" x-text="scene.purpose"></p>
                          <p class="text-[11px] uppercase tracking-[0.3em] text-indigo-200">POV: <span x-text="scene.pov"></span></p>
                        </li>
                      </template>
                    </ul>
                  </div>
                </template>
              </div>
            </template>

            <template x-if="novel.state.selectedPanelKey === 'threads'">
              <div class="space-y-4">
                <div class="flex flex-wrap items-center gap-2">
                  <template x-for="thread in novel.state.threadDefinitions" :key="thread.key">
                    <button
                      type="button"
                      class="rounded-full border px-3 py-1 text-xs font-semibold"
                      :class="thread.key === novel.state.threadSelection.selectedThreadKey ? 'border-indigo-400 bg-indigo-500/20 text-white' : 'border-white/10 bg-white/5 text-indigo-200 hover:border-indigo-400/40'"
                      @click="novel.selectThread(thread.key)"
                    >
                      <span x-text="thread.label"></span>
                    </button>
                  </template>
                </div>
                <p class="text-xs text-indigo-200" x-text="novel.selectedThread?.description"></p>
                <div class="overflow-x-auto">
                  <table class="w-full min-w-[480px] border-separate border-spacing-0 text-left text-xs">
                    <thead>
                      <tr>
                        <th class="sticky left-0 bg-slate-900/80 px-3 py-2 font-semibold text-slate-200">Chapter</th>
                        <template x-for="thread in novel.state.threadDefinitions" :key="thread.key">
                          <th class="px-3 py-2 font-semibold text-slate-200" x-text="thread.label"></th>
                        </template>
                      </tr>
                    </thead>
                    <tbody>
                      <template x-for="row in novel.state.threadHeatmap" :key="row.chapterId">
                        <tr class="border-t border-white/5">
                          <th class="sticky left-0 bg-slate-900/80 px-3 py-2 font-semibold text-slate-100" x-text="row.chapterTitle"></th>
                          <template x-for="intensity in row.intensities" :key="`${row.chapterId}-${intensity.threadKey}`">
                            <td class="px-3 py-2">
                              <div
                                class="h-6 rounded-full border border-white/10"
                                :class="[
                                  intensity.level === 0 ? 'bg-white/5' : '',
                                  intensity.level === 1 ? 'bg-indigo-500/20' : '',
                                  intensity.level === 2 ? 'bg-indigo-500/40' : '',
                                  intensity.level === 3 ? 'bg-indigo-500/80' : ''
                                ]"
                              ></div>
                            </td>
                          </template>
                        </tr>
                      </template>
                    </tbody>
                  </table>
                </div>
                <p class="text-xs text-slate-400">Intensity scale: 0 missing, 3 saturated. Use diagnostics to fill gaps before exporting.</p>
              </div>
            </template>

            <template x-if="novel.state.selectedPanelKey === 'revisions'">
              <div class="grid gap-3 md:grid-cols-2">
                <template x-for="snapshot in novel.state.revisionSnapshots" :key="snapshot.id">
                  <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">
                    <p class="text-base font-semibold text-white" x-text="snapshot.label"></p>
                    <p class="mt-1 text-xs text-slate-300" x-text="snapshot.summary"></p>
                    <p class="mt-2 text-[11px] uppercase tracking-[0.3em] text-indigo-200" x-text="new Date(snapshot.timestamp).toLocaleString()"></p>
                    <ul class="mt-2 space-y-1 text-xs text-slate-300">
                      <template x-for="highlight in snapshot.highlights" :key="`${snapshot.id}-${highlight}`">
                        <li class="rounded-full border border-white/10 bg-white/5 px-3 py-1" x-text="highlight"></li>
                      </template>
                    </ul>
                  </div>
                </template>
              </div>
            </template>

            <template x-if="novel.state.selectedPanelKey === 'settings'">
              <div class="space-y-3 text-xs text-slate-300">
                <p>Manage default structures, diagnostics thresholds, and color palettes. Configure API credentials for integrations.</p>
                <ul class="space-y-2">
                  <template x-for="endpoint in novel.state.apiEndpoints" :key="endpoint.id">
                    <li class="rounded-2xl border border-white/10 bg-slate-900/60 px-3 py-3">
                      <div class="flex items-center justify-between text-[11px] uppercase tracking-[0.3em] text-indigo-200">
                        <span x-text="endpoint.method"></span>
                        <span class="font-semibold" x-text="endpoint.path"></span>
                      </div>
                      <p class="mt-1 text-sm text-slate-200" x-text="endpoint.summary"></p>
                    </li>
                  </template>
                </ul>
              </div>
            </template>
          </div>
        </div>

        <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
          <h4 class="text-base font-semibold text-white">Diagnostics dashboard</h4>
          <p class="mt-1 text-sm text-slate-300">Monitor pacing, POV balance, thread coverage, continuity, and representation checks.</p>
          <ul class="mt-4 space-y-3 text-xs">
            <template x-for="diag in novel.state.diagnostics" :key="diag.id">
              <li class="rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3">
                <div class="flex items-center justify-between">
                  <span class="font-semibold text-white" x-text="diag.summary"></span>
                  <span class="rounded-full px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.3em]" :class="diag.severity === 'critical' ? 'bg-rose-500/20 text-rose-200' : diag.severity === 'warning' ? 'bg-amber-500/20 text-amber-200' : 'bg-emerald-500/20 text-emerald-200'" x-text="diag.severity"></span>
                </div>
                <p class="mt-1 text-slate-300" x-text="diag.suggestion"></p>
              </li>
            </template>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>
