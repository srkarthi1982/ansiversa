---
import { Button } from '@ansiversa/components';
import Layout from '../../../layouts/Layout.astro';
---
<Layout>
  <a
    class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:rounded-md focus:bg-white focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    href="#portfolio-admin"
  >
    Skip to content
  </a>
  <main
    id="portfolio-admin"
    class="bg-slate-50 min-h-screen"
    x-data="() => ({ portfolio: $store['portfolio-creator'] })"
    x-init="portfolio.initAdmin()"
  >
    <section class="border-b border-slate-200 bg-white/80 backdrop-blur">
      <div class="mx-auto flex flex-wrap items-center justify-between gap-4 px-4 py-6 sm:px-6 lg:max-w-6xl lg:px-8">
        <div>
          <h1 class="text-3xl font-bold tracking-tight text-slate-900">Portfolio Creator Admin</h1>
          <p class="text-sm text-slate-600">Monitor engagement, template adoption, and plan health across the portfolio suite.</p>
        </div>
        <div class="flex flex-wrap items-center gap-3">
          <Button type="button" variant="outline" @click.prevent="portfolio.openPlanUpsell()">
            <i class="fas fa-gem text-xs"></i>
            Promote upgrades
          </Button>
          <Button href="/portfolio-creator" variant="secondary">
            <i class="fas fa-arrow-right text-xs"></i>
            View dashboard
          </Button>
        </div>
      </div>
    </section>

    <section class="py-12">
      <div class="mx-auto grid max-w-6xl gap-6 px-4 sm:px-6 lg:grid-cols-3 lg:px-8">
        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-500">Active portfolios</h2>
          <p class="mt-3 text-3xl font-bold text-slate-900" x-text="portfolio.adminInsights.activePortfolios"></p>
          <p class="mt-2 text-xs text-slate-500">Published ratio: <span class="font-semibold text-slate-900" x-text="portfolio.adminInsights.publishedRatio"></span></p>
        </div>
        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-500">Archived</h2>
          <p class="mt-3 text-3xl font-bold text-slate-900" x-text="portfolio.adminInsights.archivedPortfolios"></p>
          <p class="mt-2 text-xs text-slate-500">Keep archived work for historic references.</p>
        </div>
        <div class="rounded-3xl border border-indigo-100 bg-indigo-50/70 p-6 shadow-sm">
          <h2 class="text-sm font-semibold uppercase tracking-wide text-indigo-900">Plan</h2>
          <p class="mt-3 text-3xl font-bold text-indigo-900" x-text="portfolio.adminInsights.plan === 'pro' ? 'Pro' : 'Free'"></p>
          <p class="mt-2 text-xs text-indigo-900">Trigger upgrade campaigns for Free users to unlock templates and AI.</p>
        </div>
      </div>
    </section>

    <section class="pb-20">
      <div class="mx-auto grid max-w-6xl gap-10 px-4 sm:px-6 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)] lg:px-8">
        <div class="space-y-6">
          <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-semibold text-slate-900">Template adoption</h2>
              <span class="text-xs text-slate-500">Based on all portfolios</span>
            </div>
            <div class="mt-6 space-y-4">
              <template x-for="template in portfolio.adminInsights.topTemplates" :key="template.key">
                <div class="flex items-center gap-4">
                  <div class="w-32 text-sm font-semibold text-slate-900" x-text="template.label"></div>
                  <div class="flex-1 rounded-full bg-slate-100">
                    <div class="h-2 rounded-full bg-gradient-to-r from-indigo-500 to-indigo-300" :style="`width: ${Math.min(template.count * 40, 100)}%`"></div>
                  </div>
                  <span class="w-10 text-right text-sm font-semibold text-slate-700" x-text="template.count"></span>
                </div>
              </template>
            </div>
          </div>

          <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-slate-900">Engagement snapshot</h2>
            <p class="mt-2 text-sm text-slate-600">Synced from sample data; wire up analytics to make it real.</p>
            <dl class="mt-6 grid gap-6 sm:grid-cols-3">
              <div class="space-y-2">
                <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Views</dt>
                <dd class="text-xl font-bold text-slate-900" x-text="Intl.NumberFormat().format(portfolio.state.metrics.views)"></dd>
              </div>
              <div class="space-y-2">
                <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Leads</dt>
                <dd class="text-xl font-bold text-slate-900" x-text="Intl.NumberFormat().format(portfolio.state.metrics.leads)"></dd>
              </div>
              <div class="space-y-2">
                <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Exports</dt>
                <dd class="text-xl font-bold text-slate-900" x-text="Intl.NumberFormat().format(portfolio.state.metrics.exports)"></dd>
              </div>
            </dl>
          </div>
        </div>

        <aside class="space-y-6">
          <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-slate-900">Operational tasks</h2>
            <ul class="mt-4 space-y-3 text-sm text-slate-700">
              <li class="flex items-start gap-3">
                <i class="fas fa-envelope-circle-check mt-1 text-xs text-indigo-500"></i>
                Sync email notifications for publish/export events.
              </li>
              <li class="flex items-start gap-3">
                <i class="fas fa-robot mt-1 text-xs text-emerald-500"></i>
                Monitor AI usage and surface upgrade prompts once free quota is exhausted.
              </li>
              <li class="flex items-start gap-3">
                <i class="fas fa-chart-simple mt-1 text-xs text-amber-500"></i>
                Pipe analytics to Data Studio dashboards for trend tracking.
              </li>
            </ul>
          </div>

          <div class="rounded-3xl border border-indigo-100 bg-indigo-50/70 p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-indigo-900">Quick actions</h2>
            <p class="mt-2 text-sm text-indigo-900">Push campaigns to boost Pro conversion.</p>
            <div class="mt-4 space-y-3">
              <Button type="button" variant="secondary" class="w-full" @click.prevent="portfolio.upgradeToPro()">
                <i class="fas fa-bolt text-xs"></i>
                Force upgrade (demo)
              </Button>
              <Button type="button" variant="outline" class="w-full" @click.prevent="portfolio.state.ai.used = 0">
                <i class="fas fa-rotate text-xs"></i>
                Reset AI quota (demo)
              </Button>
            </div>
          </div>
        </aside>
      </div>
    </section>
  </main>
</Layout>
