---
import { Button } from '@ansiversa/components';
import Layout from '../../../layouts/Layout.astro';
import { findPlanBySlug, getResourceMap, getSamplePlanDetail } from '../../../lib/career/mock';

const { slug } = Astro.params;
const plan = findPlanBySlug(slug ?? '') ?? getSamplePlanDetail();
const resources = getResourceMap();
const title = `${plan.title} — Career Sprint Plan`;
---
<Layout>
  <main class="bg-slate-50 min-h-screen">
    <section class="border-b border-slate-200 bg-white/90 py-12 shadow-sm">
      <div class="mx-auto flex max-w-5xl flex-col gap-6 px-4 sm:px-6 lg:px-8">
        <div class="flex flex-wrap items-start justify-between gap-4">
          <div class="space-y-2">
            <div class="inline-flex items-center gap-2 rounded-full bg-indigo-100 px-4 py-1.5 text-xs font-semibold text-indigo-700">
              <i class="fas fa-share text-[11px]"></i>
              Shared career sprint
            </div>
            <h1 class="text-3xl font-bold text-slate-900 sm:text-4xl">{title}</h1>
            <p class="text-sm text-slate-600 sm:text-base">
              Snapshot of a career transition plan powered by Ansiversa. Private notes and contact details are redacted for sharing.
            </p>
          </div>
          <Button href="/career-planner" variant="outline" class="shadow-sm">
            <i class="fas fa-arrow-left text-[11px]"></i>
            Back to career hub
          </Button>
        </div>
        <div class="flex flex-wrap items-center gap-3 text-xs text-slate-600">
          <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-600">
            <i class="fas fa-user text-[11px]"></i>
            {plan.profile.currentRole}
          </span>
          <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-600">
            <i class="fas fa-location-dot text-[11px]"></i>
            {plan.profile.constraints.location ?? 'Remote'}
          </span>
          <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-600">
            <i class="fas fa-clock text-[11px]"></i>
            {plan.profile.constraints.hoursPerWeek} hrs/week focus
          </span>
        </div>
      </div>
    </section>

    <section class="py-12">
      <div class="mx-auto max-w-5xl space-y-10 px-4 sm:px-6 lg:px-8">
        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <h2 class="text-xl font-semibold text-slate-900">Profile summary</h2>
          <p class="mt-2 text-sm text-slate-600">{plan.profile.summary}</p>
          <dl class="mt-4 grid gap-4 text-sm text-slate-600 sm:grid-cols-2">
            <div>
              <dt class="font-semibold text-slate-900">Industries</dt>
              <dd>{plan.profile.industries.join(', ') || '—'}</dd>
            </div>
            <div>
              <dt class="font-semibold text-slate-900">Interests</dt>
              <dd>{plan.profile.interests.join(', ') || '—'}</dd>
            </div>
            <div>
              <dt class="font-semibold text-slate-900">Experience</dt>
              <dd>{plan.profile.experienceYears} years</dd>
            </div>
            <div>
              <dt class="font-semibold text-slate-900">Working style</dt>
              <dd>{plan.profile.constraints.remote ? 'Open to remote' : 'On-site preferred'}</dd>
            </div>
          </dl>
        </section>

        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div>
              <h2 class="text-xl font-semibold text-slate-900">Target roles</h2>
              <p class="text-sm text-slate-600">Prioritised roles for this sprint.</p>
            </div>
          </div>
          <div class="mt-4 grid gap-4 md:grid-cols-2">
            {plan.targets.map((target) => (
              <article class="rounded-2xl border border-slate-200 bg-slate-50/70 p-4" key={target.roleId}>
                <h3 class="text-sm font-semibold text-slate-900">{target.roleId.replaceAll('_', ' ')}</h3>
                <p class="text-xs text-slate-500">Priority {target.priority} · Level {target.level ?? 'mid'}</p>
              </article>
            ))}
          </div>
        </section>

        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div>
              <h2 class="text-xl font-semibold text-slate-900">Skill gap matrix</h2>
              <p class="text-sm text-slate-600">Strengths vs target expectations.</p>
            </div>
          </div>
          <div class="mt-4 overflow-hidden rounded-2xl border border-slate-200">
            <table class="min-w-full divide-y divide-slate-200 text-sm">
              <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
                <tr>
                  <th class="px-4 py-3 text-left">Skill</th>
                  <th class="px-4 py-3 text-center">Current</th>
                  <th class="px-4 py-3 text-center">Target</th>
                  <th class="px-4 py-3 text-left">Priority</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-200 bg-white">
                {plan.gapMatrix.map((row) => (
                  <tr key={row.skill}>
                    <td class="px-4 py-3 font-semibold text-slate-900">{row.skill.replaceAll('_', ' ')}</td>
                    <td class="px-4 py-3 text-center">{row.current}</td>
                    <td class="px-4 py-3 text-center">{row.target}</td>
                    <td class="px-4 py-3 text-slate-600 capitalize">{row.priority}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </section>

        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div>
              <h2 class="text-xl font-semibold text-slate-900">Learning modules</h2>
              <p class="text-sm text-slate-600">Structured curriculum with checkpoints and resources.</p>
            </div>
            <span class="inline-flex items-center gap-2 rounded-full bg-indigo-100 px-3 py-1 text-xs font-semibold text-indigo-700">
              <i class="fas fa-clock text-[11px]"></i>
              {plan.learningPlan.totalHours} hrs · ETA {plan.learningPlan.etaWeeks} weeks
            </span>
          </div>
          <div class="mt-4 space-y-4">
            {plan.learningPlan.modules.map((module) => (
              <article class="rounded-2xl border border-slate-200 bg-slate-50/70 p-4" key={module.id}>
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <h3 class="text-sm font-semibold text-slate-900">{module.title}</h3>
                    <p class="text-xs uppercase tracking-wide text-slate-500">{module.difficulty}</p>
                  </div>
                  <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-600">
                    <i class="fas fa-hourglass-half text-[11px]"></i>
                    {module.hours} hrs
                  </span>
                </div>
                <p class="mt-2 text-sm text-slate-600">{module.checkpoint}</p>
                <ul class="mt-3 flex flex-wrap gap-2 text-xs text-indigo-600">
                  {module.resources.map((resourceId) => {
                    const resource = resources[resourceId];
                    return (
                      <li class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1" key={resourceId}>
                        <i class="fas fa-link text-[10px]"></i>
                        <a href={resource?.url ?? '#'} class="font-semibold text-indigo-600 hover:text-indigo-500" target="_blank" rel="noopener noreferrer">
                          {resource?.title ?? resourceId}
                        </a>
                      </li>
                    );
                  })}
                </ul>
              </article>
            ))}
          </div>
        </section>

        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <h2 class="text-xl font-semibold text-slate-900">90-day sprint highlights</h2>
          <div class="mt-4 grid gap-4 md:grid-cols-2">
            {plan.sprintPlan.weeks.map((week) => (
              <article class="rounded-2xl border border-slate-200 bg-slate-50/70 p-4" key={week.week}>
                <div class="flex items-center justify-between">
                  <h3 class="text-sm font-semibold text-slate-900">Week {week.week}</h3>
                  <span class="text-xs font-semibold uppercase tracking-wide text-indigo-600">{week.focus}</span>
                </div>
                <ul class="mt-3 space-y-2 text-xs text-slate-600">
                  {week.tasks.map((task) => (
                    <li class="flex items-start gap-2" key={task}>
                      <i class="fas fa-circle text-[6px] text-indigo-400"></i>
                      <span>{task}</span>
                    </li>
                  ))}
                </ul>
                <p class="mt-3 text-xs font-medium text-emerald-600">Milestone: {week.milestone}</p>
              </article>
            ))}
          </div>
        </section>

        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <h2 class="text-xl font-semibold text-slate-900">Portfolio projects</h2>
          <div class="mt-4 space-y-4">
            {plan.projects.map((project) => (
              <article class="rounded-2xl border border-slate-200 bg-slate-50/70 p-4" key={project.id}>
                <header class="flex items-start justify-between gap-3">
                  <div>
                    <h3 class="text-sm font-semibold text-slate-900">{project.title}</h3>
                    <p class="text-xs text-slate-500">Skills: {project.skills.join(', ')}</p>
                  </div>
                </header>
                <p class="mt-2 text-sm text-slate-600">{project.brief}</p>
                <ul class="mt-3 space-y-2 text-xs text-slate-600">
                  {project.acceptance.map((criterion) => (
                    <li class="flex items-start gap-2" key={criterion}>
                      <i class="fas fa-check text-[10px] text-emerald-500"></i>
                      <span>{criterion}</span>
                    </li>
                  ))}
                </ul>
              </article>
            ))}
          </div>
        </section>

        <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <h2 class="text-xl font-semibold text-slate-900">Resume bullet starters</h2>
          <ul class="mt-3 space-y-2 text-sm text-slate-600">
            {plan.resumeBullets.map((bullet, index) => (
              <li class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3" key={index}>{bullet}</li>
            ))}
          </ul>
        </section>

        <footer class="pb-8 text-xs text-slate-500">
          <p>Generated with Ansiversa Career Planner. This public view hides private notes and sensitive personal details.</p>
        </footer>
      </div>
    </section>
  </main>
</Layout>
