---
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/Button.astro';
import SectionHeading from '../../components/SectionHeading.astro';

const heroHighlights = [
  {
    label: 'Dialects',
    value: 'EN-US · EN-UK · EN-IN · EN-AU with locale formatting',
    icon: 'fas fa-earth-europe',
  },
  {
    label: 'Modes',
    value: 'Check-only · Auto-fix · Explain & Teach · Proofread',
    icon: 'fas fa-sliders',
  },
  {
    label: 'Exports',
    value: 'Markdown · HTML · DOCX · JSON with diff snapshots',
    icon: 'fas fa-file-export',
  },
];

const diffHighlights = [
  {
    title: 'Side-by-side diff',
    description:
      'Visualize original versus corrected copy with color-coded insertions, deletions, and rule badges for each change.',
    icon: 'fas fa-columns',
  },
  {
    title: 'Issue cards',
    description:
      'Each fix includes severity, locale note, auto-fix toggle, and a “Teach me” expansion referencing rule packs.',
    icon: 'fas fa-rectangle-list',
  },
  {
    title: 'Safe auto-apply',
    description:
      'Preview only low-risk changes in Auto mode, then graduate to extended fixes once you trust the output.',
    icon: 'fas fa-shield',
  },
];

const integrationHighlights = [
  {
    title: 'Terminology lock',
    description: 'Attach CSV glossaries, case-sensitive brand rules, and do-not-change tokens before running analysis.',
    icon: 'fas fa-book-bookmark',
  },
  {
    title: 'Readability targets',
    description: 'Grade-level monitoring, average sentence length alerts, and bulletization hints keep copy skimmable.',
    icon: 'fas fa-chart-line',
  },
  {
    title: 'PII masking',
    description: 'Scan and optionally redact emails, phone numbers, and IDs before text hits the model.',
    icon: 'fas fa-user-lock',
  },
];
---

<Layout>
  <a
    class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:rounded-md focus:bg-white focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    href="#grammar-workspace"
  >
    Skip to Grammar Fixer workspace
  </a>
  <main
    id="grammar-workspace"
    class="bg-slate-50 min-h-screen"
    x-data="() => ({ grammar: $store.grammar })"
    x-init="grammar.init()"
  >
    <section class="relative overflow-hidden py-16 sm:py-20">
      <div class="absolute inset-0 bg-gradient-to-br from-indigo-100 via-white to-transparent"></div>
      <div class="relative mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
        <div class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr] lg:items-center">
          <div class="space-y-6 text-center lg:text-left">
            <span class="inline-flex items-center gap-2 rounded-full bg-indigo-100 px-4 py-1.5 text-sm font-semibold text-indigo-700">
              <i class="fas fa-feather-pointed text-xs"></i>
              Grammar & style intelligence
            </span>
            <h1 class="text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">
              Grammar Fixer workspace
            </h1>
            <p class="text-base text-slate-600 sm:text-lg">
              Audit grammar, spelling, punctuation, style, and clarity in one pass. Dialects, style guides, inclusive language,
              readability targets, and glossary locks ensure every export is publication-ready.
            </p>
            <div class="flex flex-wrap justify-center gap-3 lg:justify-start">
              <Button type="button" @click.prevent="grammar.analyze()">
                <i class="fas fa-play text-xs"></i>
                Run analysis
              </Button>
              <Button type="button" variant="outline" @click.prevent="grammar.applyAllSafe()">
                <i class="fas fa-wand-magic-sparkles text-xs"></i>
                Apply safe fixes
              </Button>
              <Button type="button" variant="ghost" @click.prevent="grammar.setPlan(grammar.state.plan === 'pro' ? 'free' : 'pro')">
                <i class="fas fa-crown text-xs"></i>
                <span x-text="grammar.state.plan === 'pro' ? 'Pro plan active' : 'Upgrade to Pro preview'"></span>
              </Button>
            </div>
            <dl class="grid gap-4 sm:grid-cols-3">
              {heroHighlights.map((highlight) => (
                <div class="rounded-2xl bg-white/80 p-4 shadow-sm backdrop-blur" key={highlight.label}>
                  <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">
                    <i class={`${highlight.icon} mr-2 text-[11px]`}></i>
                    <span>{highlight.label}</span>
                  </dt>
                  <dd class="mt-2 text-sm font-semibold text-slate-900">{highlight.value}</dd>
                </div>
              ))}
            </dl>
          </div>
          <aside class="relative">
            <div class="absolute inset-0 translate-x-6 translate-y-6 rounded-3xl bg-indigo-200 opacity-50 blur-xl"></div>
            <div class="relative space-y-6 rounded-3xl border border-slate-200 bg-white p-6 shadow-xl">
              <header class="flex items-center justify-between gap-3">
                <div>
                  <p class="text-sm font-semibold text-slate-900">Workspace snapshot</p>
                  <p class="text-xs text-slate-500">Track readability, open issues, and rule coverage in real time.</p>
                </div>
                <span
                  class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold"
                  :class="grammar.state.plan === 'pro' ? 'bg-emerald-100 text-emerald-700' : 'bg-indigo-100 text-indigo-700'"
                >
                  <i class="fas" :class="grammar.state.plan === 'pro' ? 'fa-star' : 'fa-circle'" class="text-[10px]"></i>
                  <span x-text="grammar.state.plan === 'pro' ? 'Pro plan' : 'Free plan'"></span>
                </span>
              </header>
              <dl class="grid gap-4 sm:grid-cols-2">
                <div class="rounded-2xl bg-slate-50 p-4">
                  <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Open issues</dt>
                  <dd class="mt-2 text-3xl font-semibold text-slate-900" x-text="grammar.issueSummary.total"></dd>
                  <p class="mt-1 text-[11px] text-slate-500">
                    <span class="font-medium text-rose-600" x-text="grammar.issueSummary.error"></span>
                    errors ·
                    <span class="font-medium text-amber-600" x-text="grammar.issueSummary.warn"></span>
                    warnings ·
                    <span class="font-medium text-slate-500" x-text="grammar.issueSummary.info"></span>
                    notes
                  </p>
                </div>
                <div class="rounded-2xl bg-slate-50 p-4">
                  <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Readability grade</dt>
                  <dd class="mt-2 flex items-baseline gap-2">
                    <span class="text-3xl font-semibold text-slate-900" x-text="grammar.state.metrics.grade.toFixed(1)"></span>
                    <span class="text-xs font-medium text-slate-500" x-text="grammar.state.metrics.targetLabel"></span>
                  </dd>
                  <p class="mt-1 text-[11px]" :class="grammar.state.metrics.gradeStatus === 'within' ? 'text-emerald-600' : 'text-amber-600'">
                    <span x-text="grammar.state.metrics.gradeStatus === 'within' ? 'On target' : 'Needs simplifying'"></span>
                    · Reading ease
                    <span class="font-semibold" x-text="grammar.state.metrics.readingEase.toFixed(1)"></span>
                  </p>
                </div>
              </dl>
              <div class="rounded-2xl border border-indigo-100 bg-indigo-50 px-4 py-3 text-xs text-indigo-700">
                <p>
                  Dialect:
                  <span class="font-semibold" x-text="grammar.dialects.find((d) => d.value === grammar.state.dialect)?.label"></span>
                </p>
                <p>
                  Style guide:
                  <span class="font-semibold" x-text="grammar.styleGuides.find((s) => s.value === grammar.state.styleGuide)?.label"></span>
                </p>
                <p>
                  Mode:
                  <span class="font-semibold" x-text="grammar.modes.find((m) => m.value === grammar.state.mode)?.label"></span>
                </p>
              </div>
              <p class="text-[11px] text-slate-500">Last analyzed <span x-text="grammar.state.lastAnalyzedAt ? new Date(grammar.state.lastAnalyzedAt).toLocaleTimeString() : '—'"></span></p>
            </div>
          </aside>
        </div>
      </div>
    </section>

    <section class="pb-16">
      <div class="mx-auto max-w-6xl space-y-12 px-4 sm:px-6 lg:px-8" x-data>
        <div class="grid gap-8 lg:grid-cols-[1.15fr_0.85fr]">
          <article class="rounded-3xl border border-slate-200 bg-white shadow-sm">
            <header class="flex flex-wrap items-center justify-between gap-4 border-b border-slate-100 px-6 py-4">
              <div>
                <h2 class="text-lg font-semibold text-slate-900">Input</h2>
                <p class="text-xs text-slate-500">Paste draft, select dialect, and choose how aggressively to auto-fix.</p>
              </div>
              <div class="flex flex-wrap gap-2 text-xs">
                <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-slate-600">
                  <i class="fas fa-align-left text-[10px]"></i>
                  <span x-text="`${grammar.state.metrics.words} words`"></span>
                </span>
                <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-slate-600">
                  <i class="fas fa-clock text-[10px]"></i>
                  <span x-text="`${grammar.state.metrics.readingTimeMinutes} min read`"></span>
                </span>
              </div>
            </header>
            <div class="space-y-6 p-6">
              <div class="grid gap-3 md:grid-cols-2">
                <label class="flex flex-col gap-1 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs font-medium text-slate-600">
                  <span>Dialect</span>
                  <select
                    class="bg-transparent text-sm font-semibold text-slate-800 focus:outline-none"
                    x-model="grammar.state.dialect"
                    @change="grammar.setDialect($event.target.value)"
                  >
                    <template x-for="option in grammar.dialects" :key="option.value">
                      <option :value="option.value" x-text="option.label"></option>
                    </template>
                  </select>
                </label>
                <label class="flex flex-col gap-1 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs font-medium text-slate-600">
                  <span>Style guide</span>
                  <select
                    class="bg-transparent text-sm font-semibold text-slate-800 focus:outline-none"
                    x-model="grammar.state.styleGuide"
                    @change="grammar.setStyle($event.target.value)"
                  >
                    <template x-for="option in grammar.styleGuides" :key="option.value">
                      <option :value="option.value" x-text="option.label"></option>
                    </template>
                  </select>
                </label>
                <label class="flex flex-col gap-1 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs font-medium text-slate-600">
                  <span>Mode</span>
                  <select
                    class="bg-transparent text-sm font-semibold text-slate-800 focus:outline-none"
                    x-model="grammar.state.mode"
                    @change="grammar.setMode($event.target.value)"
                  >
                    <template x-for="mode in grammar.modes" :key="mode.value">
                      <option :value="mode.value" x-text="mode.label"></option>
                    </template>
                  </select>
                </label>
                <label class="flex flex-col gap-1 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs font-medium text-slate-600">
                  <span>Readability target</span>
                  <select
                    class="bg-transparent text-sm font-semibold text-slate-800 focus:outline-none"
                    x-model="grammar.state.readabilityTarget"
                    @change="grammar.setReadabilityTarget($event.target.value)"
                  >
                    <template x-for="option in grammar.readabilityTargets" :key="option.value">
                      <option :value="option.value" x-text="option.label"></option>
                    </template>
                  </select>
                </label>
              </div>
              <div class="flex flex-wrap items-center gap-3 text-xs text-slate-600">
                <label class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 font-medium">
                  <input type="checkbox" class="h-3.5 w-3.5 rounded border-slate-300 text-indigo-600" x-model="grammar.state.inclusiveLanguage" @change="grammar.toggleInclusiveLanguage()" />
                  Inclusive language checks
                </label>
                <label class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 font-medium">
                  <input type="checkbox" class="h-3.5 w-3.5 rounded border-slate-300 text-indigo-600" x-model="grammar.state.piiMasking" @change="grammar.togglePiiMasking()" />
                  PII masking preview
                </label>
                <label class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 font-medium">
                  <span>Auto apply</span>
                  <select
                    class="bg-transparent font-semibold text-slate-800 focus:outline-none"
                    x-model="grammar.state.autoApplyMode"
                    @change="grammar.setAutoApplyMode($event.target.value)"
                  >
                    <option value="safe">Safe rules</option>
                    <option value="extended">Extended (Pro)</option>
                  </select>
                </label>
              </div>
              <textarea
                class="min-h-[220px] w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-800 shadow-inner focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                x-model="grammar.state.input"
                @input.debounce.600ms="grammar.analyze()"
              ></textarea>
              <div class="flex flex-wrap items-center justify-between gap-3">
                <div class="flex flex-wrap gap-2 text-xs">
                  <template x-for="toggle in grammar.state.ruleToggles" :key="toggle.id">
                    <button
                      type="button"
                      class="rounded-full px-3 py-1 font-semibold transition"
                      :class="toggle.enabled ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100 text-slate-500 hover:bg-indigo-50 hover:text-indigo-600'"
                      @click="grammar.toggleRulePack(toggle.id)"
                    >
                      <span x-text="grammar.rulePacks.find((pack) => pack.id === toggle.id)?.name"></span>
                    </button>
                  </template>
                </div>
                <div class="flex items-center gap-2 text-xs text-slate-500">
                  <i class="fas fa-circle-notch animate-spin text-[10px] text-indigo-500" x-show="grammar.state.running"></i>
                  <span x-text="grammar.state.running ? 'Analyzing…' : 'Analysis up to date'"></span>
                </div>
              </div>
            </div>
          </article>

          <aside class="flex h-full flex-col gap-4">
            <article class="flex-1 rounded-3xl border border-slate-200 bg-white shadow-sm">
              <header class="flex items-center justify-between gap-3 border-b border-slate-100 px-6 py-4">
                <div>
                  <h2 class="text-lg font-semibold text-slate-900">Suggestions</h2>
                  <p class="text-xs text-slate-500">Filter by severity, rule pack, or auto-fixable status.</p>
                </div>
                <div class="flex items-center gap-2 text-xs text-slate-500">
                  <label class="flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1">
                    <span>Severity</span>
                    <select
                      class="bg-transparent font-semibold text-slate-700 focus:outline-none"
                      x-model="grammar.state.filters.severity"
                      @change="grammar.setFilter('severity', $event.target.value)"
                    >
                      <option value="all">All</option>
                      <option value="error">Errors</option>
                      <option value="warn">Warnings</option>
                      <option value="info">Notes</option>
                    </select>
                  </label>
                  <label class="flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1">
                    <span>Pack</span>
                    <select
                      class="bg-transparent font-semibold text-slate-700 focus:outline-none"
                      x-model="grammar.state.filters.packId"
                      @change="grammar.setFilter('packId', $event.target.value)"
                    >
                      <option value="all">All packs</option>
                      <template x-for="pack in grammar.rulePacks" :key="pack.id">
                        <option :value="pack.id" x-text="pack.name"></option>
                      </template>
                    </select>
                  </label>
                  <label class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1">
                    <input type="checkbox" class="h-3.5 w-3.5 rounded border-slate-300 text-indigo-600" x-model="grammar.state.filters.autoFixOnly" @change="grammar.setFilter('autoFixOnly', $event.target.checked)" />
                    Auto-fix only
                  </label>
                </div>
              </header>
              <div class="max-h-[420px] space-y-3 overflow-y-auto px-6 py-4">
                <template x-if="grammar.filteredSuggestions.length === 0">
                  <div class="rounded-2xl border border-dashed border-slate-300 bg-white p-8 text-center text-sm text-slate-500">
                    No suggestions match current filters.
                  </div>
                </template>
                <template x-for="suggestion in grammar.filteredSuggestions" :key="suggestion.id">
                  <article
                    class="rounded-2xl border px-4 py-3 transition hover:border-indigo-200"
                    :class="[
                      suggestion.status === 'applied'
                        ? 'border-emerald-200 bg-emerald-50/70'
                        : suggestion.status === 'dismissed'
                          ? 'border-slate-200 bg-slate-50'
                          : 'border-slate-200 bg-white shadow-sm',
                    ]"
                    @mouseenter="grammar.focusSuggestion(suggestion.id)"
                  >
                    <header class="flex flex-wrap items-center justify-between gap-2">
                      <div class="flex items-center gap-2">
                        <span
                          class="inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold"
                          :class="{
                            'bg-rose-100 text-rose-700': suggestion.severity === 'error',
                            'bg-amber-100 text-amber-700': suggestion.severity === 'warn',
                            'bg-slate-100 text-slate-600': suggestion.severity === 'info',
                          }"
                        >
                          <i class="fas fa-circle-exclamation text-[9px]"></i>
                          <span x-text="suggestion.severity"></span>
                        </span>
                        <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">
                          <i class="fas fa-tag mr-1 text-[9px]"></i>
                          <span x-text="suggestion.packId"></span>
                        </span>
                      </div>
                      <div class="flex items-center gap-2 text-xs">
                        <Button
                          type="button"
                          variant="ghost"
                          class="text-[11px]"
                          @click.prevent="suggestion.status === 'dismissed' ? grammar.restoreSuggestion(suggestion.id) : grammar.dismissSuggestion(suggestion.id)"
                        >
                          <i class="fas" :class="suggestion.status === 'dismissed' ? 'fa-rotate-left' : 'fa-ban'"></i>
                          <span x-text="suggestion.status === 'dismissed' ? 'Restore' : 'Dismiss'"></span>
                        </Button>
                        <Button
                          type="button"
                          variant="outline"
                          class="text-[11px]"
                          :disabled="!suggestion.autoFixable || suggestion.status !== 'open'"
                          @click.prevent="grammar.applySuggestion(suggestion.id)"
                        >
                          <i class="fas fa-wand-magic-sparkles text-[9px]"></i>
                          Apply
                        </Button>
                      </div>
                    </header>
                    <h3 class="mt-2 text-sm font-semibold text-slate-900" x-text="suggestion.title"></h3>
                    <p class="mt-1 text-xs text-slate-500" x-text="suggestion.description"></p>
                    <div class="mt-3 grid gap-2 rounded-2xl bg-slate-50 px-3 py-2 text-[11px] text-slate-600">
                      <p>
                        <span class="font-semibold text-slate-700">Before:</span>
                        <span class="font-mono" x-text="suggestion.before"></span>
                      </p>
                      <p>
                        <span class="font-semibold text-slate-700">After:</span>
                        <span class="font-mono" x-text="suggestion.after"></span>
                      </p>
                    </div>
                    <p class="mt-2 text-xs text-slate-500" x-text="suggestion.explanation"></p>
                    <p class="mt-1 text-[11px] text-indigo-600" x-show="suggestion.teachReference">
                      <i class="fas fa-graduation-cap mr-1 text-[9px]"></i>
                      <span x-text="suggestion.teachReference"></span>
                    </p>
                  </article>
                </template>
              </div>
            </article>
            <article class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
              <h2 class="text-base font-semibold text-slate-900">Output preview</h2>
              <p class="mt-1 text-xs text-slate-500">Shows safe auto-applied fixes for quick sanity checks. Extended mode requires Pro.</p>
              <pre class="mt-4 max-h-52 overflow-y-auto rounded-2xl bg-slate-50 px-4 py-3 text-sm text-slate-800" x-text="grammar.state.outputPreview"></pre>
              <div class="mt-4 flex flex-wrap gap-2 text-xs">
                <Button type="button" class="text-xs" variant="outline" @click.prevent="window.navigator?.clipboard?.writeText(grammar.state.outputPreview)">
                  <i class="fas fa-copy text-[10px]"></i>
                  Copy preview
                </Button>
                <Button type="button" class="text-xs" variant="ghost" @click.prevent="grammar.applyAllSafe()">
                  <i class="fas fa-magic text-[10px]"></i>
                  Apply safe fixes
                </Button>
              </div>
            </article>
          </aside>
        </div>

        <div class="grid gap-6 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm lg:grid-cols-3">
          {diffHighlights.map((highlight) => (
            <div class="rounded-2xl border border-dashed border-indigo-200 bg-indigo-50/60 p-5 text-sm text-indigo-800" key={highlight.title}>
              <h3 class="flex items-center gap-2 text-base font-semibold text-indigo-900">
                <i class={`${highlight.icon} text-sm`}></i>
                <span>{highlight.title}</span>
              </h3>
              <p class="mt-2">{highlight.description}</p>
            </div>
          ))}
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <SectionHeading eyebrow="Rule packs & automation" title="Curate fix scope per project" />
          <div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
            <template x-for="pack in grammar.rulePacks" :key="pack.id">
              <article class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex items-center justify-between">
                  <h3 class="text-sm font-semibold text-slate-900" x-text="pack.name"></h3>
                  <i :class="pack.icon" class="text-xs text-indigo-500"></i>
                </div>
                <p class="mt-2 text-xs text-slate-600" x-text="pack.description"></p>
                <p class="mt-3 text-[11px] text-slate-500">
                  Status:
                  <span class="font-semibold" x-text="grammar.state.ruleToggles.find((toggle) => toggle.id === pack.id)?.enabled ? 'Enabled' : 'Paused'"></span>
                </p>
              </article>
            </template>
          </div>
        </div>

        <div class="grid gap-6 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm lg:grid-cols-[1.05fr_0.95fr]">
          <div class="space-y-4">
            <SectionHeading eyebrow="Glossary lock" title="Protect product terminology" />
            <p class="text-sm text-slate-600">
              Upload CSV/JSON glossaries or add inline entries to keep product names, acronyms, and tone markers untouched. Toggle locks as needed before exporting.
            </p>
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <form class="grid gap-3 sm:grid-cols-[1fr_1fr_auto]" @submit.prevent="grammar.addGlossaryEntry()">
                <label class="flex flex-col text-xs font-medium text-slate-600">
                  <span>Term</span>
                  <input
                    type="text"
                    class="mt-1 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-800 focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                    x-model="grammar.state.glossary.newTerm"
                    placeholder="Brand term"
                  />
                </label>
                <label class="flex flex-col text-xs font-medium text-slate-600">
                  <span>Preferred form</span>
                  <input
                    type="text"
                    class="mt-1 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-800 focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                    x-model="grammar.state.glossary.newReplacement"
                    placeholder="Exact casing"
                  />
                </label>
                <div class="flex flex-col justify-end gap-2 text-xs text-slate-600">
                  <label class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-2 font-medium">
                    <input type="checkbox" class="h-3.5 w-3.5 rounded border-slate-300 text-indigo-600" x-model="grammar.state.glossary.caseSensitive" />
                    Case sensitive
                  </label>
                  <Button type="submit" class="text-xs">
                    <i class="fas fa-plus text-[10px]"></i>
                    Add term
                  </Button>
                </div>
              </form>
              <div class="mt-4 space-y-3">
                <template x-for="(entry, index) in grammar.state.glossary.entries" :key="`${entry.term}-${index}`">
                  <div class="flex items-center justify-between gap-3 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700">
                    <div>
                      <p class="font-semibold" x-text="entry.term"></p>
                      <p class="text-xs text-slate-500">
                        Prefers <span class="font-medium" x-text="entry.replacement"></span>
                        · <span x-text="entry.caseSensitive ? 'Case locked' : 'Flexible case'"></span>
                      </p>
                      <p class="text-xs text-slate-500" x-text="entry.note"></p>
                    </div>
                    <div class="flex items-center gap-2 text-xs">
                      <Button type="button" variant="ghost" class="text-[11px]" @click.prevent="grammar.toggleGlossaryLock(index)">
                        <i class="fas" :class="entry.locked ? 'fa-lock' : 'fa-lock-open'"></i>
                        <span x-text="entry.locked ? 'Locked' : 'Unlocked'"></span>
                      </Button>
                      <Button type="button" variant="ghost" class="text-[11px] text-rose-500" @click.prevent="grammar.removeGlossaryEntry(index)">
                        <i class="fas fa-trash text-[10px]"></i>
                        Remove
                      </Button>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
          <div class="space-y-4">
            <SectionHeading eyebrow="Integrations" title="Hand off to other Ansiversa studios" />
            <div class="space-y-3">
              <template x-for="destination in grammar.handoffDestinations" :key="destination.href">
                <a
                  class="flex items-start gap-3 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700 transition hover:border-indigo-200 hover:bg-white"
                  :href="destination.href"
                >
                  <i :class="destination.icon" class="mt-1 text-indigo-500"></i>
                  <div>
                    <p class="font-semibold text-slate-900" x-text="destination.label"></p>
                    <p class="text-xs text-slate-500" x-text="destination.description"></p>
                  </div>
                </a>
              </template>
            </div>
            <div class="rounded-2xl border border-indigo-100 bg-indigo-50 px-4 py-3 text-xs text-indigo-700">
              <p class="font-semibold">PII masking</p>
              <p>Enable masking to redact sensitive tokens before sending text to the model. Pro plan unlocks auto-redaction rules.</p>
            </div>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <SectionHeading eyebrow="Readability coach" title="Keep text approachable" />
          <div class="mt-6 grid gap-6 lg:grid-cols-3">
            {integrationHighlights.map((card) => (
              <article class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700" key={card.title}>
                <h3 class="flex items-center gap-2 text-base font-semibold text-slate-900">
                  <i class={`${card.icon} text-sm text-indigo-500`}></i>
                  <span>{card.title}</span>
                </h3>
                <p class="mt-2 text-xs text-slate-600">{card.description}</p>
              </article>
            ))}
          </div>
          <div class="mt-6 rounded-2xl border border-dashed border-indigo-200 bg-indigo-50/60 px-4 py-3 text-xs text-indigo-700">
            <p class="font-semibold">Recommendations</p>
            <template x-if="grammar.state.recommendations.length === 0">
              <p class="mt-1">All good! Your draft meets current targets.</p>
            </template>
            <ul class="mt-1 space-y-1" x-show="grammar.state.recommendations.length">
              <template x-for="(item, index) in grammar.state.recommendations" :key="`rec-${index}`">
                <li class="flex items-start gap-2">
                  <i class="fas fa-check text-[10px] text-indigo-500"></i>
                  <span x-text="item"></span>
                </li>
              </template>
            </ul>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <SectionHeading eyebrow="Workflow" title="Routes across the Grammar Fixer suite" />
          <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
            <template x-for="route in grammar.routes" :key="route.route">
              <article class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700">
                <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Route</p>
                <p class="mt-1 text-base font-semibold text-slate-900">
                  <i :class="route.icon" class="mr-2 text-[11px] text-indigo-500"></i>
                  <span x-text="route.route"></span>
                </p>
                <p class="mt-2 text-xs text-slate-600" x-text="route.label"></p>
              </article>
            </template>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <SectionHeading eyebrow="Plan gating" title="Free vs Pro" />
          <div class="mt-4 overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200 text-sm">
              <thead class="bg-slate-50">
                <tr class="text-left text-xs font-semibold uppercase tracking-wide text-slate-500">
                  <th class="px-4 py-3">Feature</th>
                  <th class="px-4 py-3">Free</th>
                  <th class="px-4 py-3">Pro</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-100">
                <template x-for="row in grammar.planRows" :key="row.feature">
                  <tr class="text-slate-700">
                    <td class="px-4 py-3 font-medium" x-text="row.feature"></td>
                    <td class="px-4 py-3" x-text="row.free"></td>
                    <td class="px-4 py-3" x-text="row.pro"></td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <SectionHeading eyebrow="Batch & privacy" title="Automate large document sweeps" />
          <div class="mt-4 grid gap-4 lg:grid-cols-2">
            <div class="space-y-3">
              <template x-for="playbook in grammar.batchPlaybooks" :key="playbook.title">
                <article class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700">
                  <h3 class="flex items-center gap-2 text-base font-semibold text-slate-900">
                    <i :class="playbook.icon" class="text-sm text-indigo-500"></i>
                    <span x-text="playbook.title"></span>
                  </h3>
                  <p class="mt-2 text-xs text-slate-600" x-text="playbook.description"></p>
                </article>
              </template>
            </div>
            <div class="space-y-3">
              <template x-for="feature in grammar.privacyFeatures" :key="feature.title">
                <article class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700">
                  <h3 class="flex items-center gap-2 text-base font-semibold text-slate-900">
                    <i :class="feature.icon" class="text-sm text-indigo-500"></i>
                    <span x-text="feature.title"></span>
                  </h3>
                  <p class="mt-2 text-xs text-slate-600" x-text="feature.description"></p>
                </article>
              </template>
            </div>
          </div>
        </div>
      </div>
    </section>

    <template x-if="grammar.state.toast">
      <div class="fixed inset-x-4 bottom-4 z-50 mx-auto max-w-md rounded-2xl border border-slate-200 bg-white p-4 shadow-lg shadow-indigo-900/10">
        <div class="flex items-center justify-between gap-3">
          <div>
            <p class="text-sm font-semibold text-slate-900" x-text="grammar.state.toast?.message"></p>
          </div>
          <button type="button" class="text-slate-400 transition hover:text-slate-600" @click="grammar.clearToast()">
            <i class="fas fa-xmark"></i>
            <span class="sr-only">Dismiss notification</span>
          </button>
        </div>
      </div>
    </template>
  </main>
</Layout>
