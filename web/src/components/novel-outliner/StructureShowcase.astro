---
import SectionHeading from "../SectionHeading.astro";
---
<section class="bg-slate-950 py-16 text-white" x-data="() => ({ novel: $store['novel-outliner'] })">
  <div class="mx-auto max-w-6xl space-y-10 px-4 sm:px-6 lg:px-8">
    <SectionHeading
      eyebrow="Structure lab"
      title="Switch frameworks without losing your beats"
      description="Preview pacing, beat focus, and genre recommendations. Apply structures instantly â€” Novel Outliner remaps beats and diagnostics on the fly."
      titleClass="mt-3 text-3xl font-bold tracking-tight sm:text-4xl text-white"
      descriptionClass="mt-4 text-base text-slate-300"
      eyebrowClass="text-xs font-semibold uppercase tracking-[0.35em] text-indigo-300"
    />
    <div class="grid gap-8 lg:grid-cols-[0.85fr_1.15fr]">
      <div class="space-y-3">
        <template x-for="preset in novel.state.structurePresets" :key="preset.key">
          <button
            type="button"
            class="w-full rounded-3xl border px-5 py-4 text-left transition"
            :class="[
              preset.key === novel.state.selectedStructureKey ? 'border-indigo-400 bg-indigo-500/20 shadow-lg shadow-indigo-500/20' : 'border-white/10 bg-white/5 hover:border-indigo-300/70',
              preset.plan === 'pro' && novel.plan === 'free' ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer'
            ]"
            @click="novel.selectStructure(preset.key)"
          >
            <div class="flex items-start justify-between gap-3">
              <div>
                <p class="text-base font-semibold" x-text="preset.name"></p>
                <p class="mt-1 text-xs text-slate-300" x-text="preset.summary"></p>
              </div>
              <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.3em]"
                :class="preset.plan === 'pro' ? 'bg-indigo-500/30 text-indigo-100 border border-indigo-400/40' : 'bg-white/10 text-white border border-white/20'">
                <i class="fa-solid" :class="preset.plan === 'pro' ? 'fa-crown text-[9px]' : 'fa-circle-dot text-[8px]'"></i>
                <span x-text="preset.plan === 'pro' ? 'Pro' : 'Free'"></span>
              </span>
            </div>
            <div class="mt-4 flex flex-wrap gap-2 text-[10px] font-semibold uppercase tracking-[0.3em] text-indigo-200">
              <span class="inline-flex items-center gap-2 rounded-full border border-indigo-400/40 bg-indigo-500/20 px-3 py-1">
                <i class="fa-solid fa-clock text-[9px]"></i>
                <span x-text="preset.acts.reduce((acc, act) => acc + act.beats.length, 0) + ' beats'"></span>
              </span>
              <template x-for="tag in preset.bestFor" :key="tag">
                <span class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-white/80" x-text="tag"></span>
              </template>
            </div>
          </button>
        </template>
      </div>
      <div class="rounded-3xl border border-indigo-400/40 bg-white/5 p-6">
        <template x-if="novel.selectedStructure">
          <div>
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div>
                <h3 class="text-2xl font-semibold text-white" x-text="novel.selectedStructure.name"></h3>
                <p class="mt-1 text-sm text-slate-300" x-text="novel.selectedStructure.pacingNotes"></p>
              </div>
              <div class="rounded-2xl border border-white/10 bg-white/10 px-4 py-2 text-xs text-white/80">
                <p class="font-semibold uppercase tracking-[0.3em] text-indigo-200">Snowflake sync</p>
                <p class="mt-1">Completion <span class="font-semibold text-white" x-text="`${novel.snowflakeCompletionPercent}%`"></span></p>
              </div>
            </div>
            <div class="mt-6 space-y-6">
              <template x-for="act in novel.selectedStructure.acts" :key="act.id">
                <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
                  <div class="flex items-center justify-between">
                    <h4 class="text-lg font-semibold text-white" x-text="act.label"></h4>
                    <span class="text-xs uppercase tracking-[0.3em] text-indigo-200" x-text="`${act.beats.length} beats`"></span>
                  </div>
                  <div class="mt-4 grid gap-3 lg:grid-cols-2">
                    <template x-for="beat in act.beats" :key="beat.id">
                      <div class="rounded-2xl border border-indigo-400/40 bg-slate-900/60 px-4 py-3">
                        <div class="flex items-start justify-between gap-2">
                          <p class="text-sm font-semibold text-white" x-text="beat.label"></p>
                          <span class="text-[10px] font-semibold uppercase tracking-[0.3em] text-indigo-300" x-text="`${beat.targetPercent}%`"></span>
                        </div>
                        <p class="mt-2 text-xs text-slate-300" x-text="beat.description"></p>
                        <p class="mt-2 inline-flex items-center gap-2 rounded-full border border-indigo-400/30 bg-indigo-500/10 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.3em] text-indigo-200">
                          <i class="fa-solid fa-compass text-[8px]"></i>
                          <span x-text="beat.focus"></span>
                        </p>
                      </div>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </template>
      </div>
    </div>
  </div>
</section>
